<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>graphics_manager &mdash; R-View Tool v1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=76e2d817"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../docs_home.html" class="icon icon-home">
            R-View Tool
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">R-View Tool</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../docs_home.html">R-View Tool</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../docs_home.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">graphics_manager</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for graphics_manager</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="kn">import</span> <span class="nn">PIL</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageTk</span>

<span class="kn">from</span> <span class="nn">tools</span> <span class="kn">import</span> <span class="n">Tools</span>
<span class="kn">from</span> <span class="nn">tools</span> <span class="kn">import</span> <span class="n">TextInsertWindow</span>


<div class="viewcode-block" id="GraphicsManager">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager">[docs]</a>
<span class="k">class</span> <span class="nc">GraphicsManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    GraphicsManager Class manages the drawing and display of annotations(graphics) that gets drawn onto the images.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">is_overlay</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialising the Class with a given canvas.</span>

<span class="sd">        Args:</span>
<span class="sd">            app: Tkinter main app</span>
<span class="sd">            canvas: Tkinter Canvas</span>
<span class="sd">            is_overlay (bool): True if the canvas is the overlay canvas. Default False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span> <span class="o">=</span> <span class="n">canvas</span>  <span class="c1"># image_canvas for base and overlay_canvas for the overlay elements.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_y</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_axis_constraint</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stored_axis_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_text_repositioning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_text_scaling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1"># Offset so that the text objects anchor point does not snap to the mouse cursor.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_offset_x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_offset_y</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ready_to_draw</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">interior_fill_color</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outline_fill_color</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scribble</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scribble_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_stroke</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_to_reset</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom_to_reset</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_visibility</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">insert_text_window</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_overlay</span> <span class="o">=</span> <span class="n">is_overlay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_GRAPHICS_INDEX</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># dictionary index of the overlay canvas.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_IMAGES_INDEX</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>  <span class="c1"># dictionary index where the images.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_text_selection_border</span><span class="p">()</span>

<div class="viewcode-block" id="GraphicsManager.draw_graphic_elements_from_project_file">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.draw_graphic_elements_from_project_file">[docs]</a>
    <span class="k">def</span> <span class="nf">draw_graphic_elements_from_project_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_overlay</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unpacks the loaded_graphics_data_dict and based on the tool used, mimics the events that happens during the normal drawing.</span>

<span class="sd">        Args:</span>
<span class="sd">            is_overlay: If True, the graphic elements from OVERLAY_GRAPHICS_INDEX([-1])gets drawn on the overlay_canvas. Default False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Basically feeding in all values to the action that happens when the mouse click is released.</span>
        <span class="n">total_images_to_redraw</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>  <span class="c1"># excluding the overlay indexes</span>
        <span class="n">graphics_redrawn</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># the 0.5 progress from the file indexing.</span>

        <span class="k">for</span> <span class="n">image_index</span><span class="p">,</span> <span class="n">graphic_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loaded_graphics_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># excluding overlay items. unless specified (overlay elements).</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">image_index</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">graphic_dict</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">image_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">is_overlay</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">item_id</span><span class="p">,</span> <span class="n">graphic_object</span> <span class="ow">in</span> <span class="n">graphic_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ready_to_draw</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">Tools</span><span class="o">.</span><span class="n">stroke_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_width_to_max_size</span><span class="p">(</span><span class="n">graphic_object</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scribble_width</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">stroke_width</span>

                    <span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span> <span class="o">=</span> <span class="n">graphic_object</span><span class="o">.</span><span class="n">tool</span>
                    <span class="n">Tools</span><span class="o">.</span><span class="n">stipple</span> <span class="o">=</span> <span class="n">graphic_object</span><span class="o">.</span><span class="n">stipple</span>
                    <span class="n">Tools</span><span class="o">.</span><span class="n">endcap</span> <span class="o">=</span> <span class="n">graphic_object</span><span class="o">.</span><span class="n">capstyle</span>
                    <span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span> <span class="o">=</span> <span class="n">graphic_object</span><span class="o">.</span><span class="n">fill_color</span>
                    <span class="n">Tools</span><span class="o">.</span><span class="n">shape_fill</span> <span class="o">=</span> <span class="n">graphic_object</span><span class="o">.</span><span class="n">shape_fill</span>

                    <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font</span> <span class="o">=</span> <span class="n">graphic_object</span><span class="o">.</span><span class="n">font_name</span>
                    <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font_file</span> <span class="o">=</span> <span class="n">graphic_object</span><span class="o">.</span><span class="n">font_file</span>
                    <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_width_to_max_size</span><span class="p">(</span>
                        <span class="n">stroke_width</span><span class="o">=</span><span class="n">graphic_object</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s2">&quot;font&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">Tools</span><span class="o">.</span><span class="n">shape_fill</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">interior_fill_color</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">outline_fill_color</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># only outline</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">interior_fill_color</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">outline_fill_color</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scribble_width</span> <span class="o">/</span> <span class="mi">2</span>

                    <span class="k">if</span> <span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># if it&#39;s a text item.</span>
                        <span class="c1"># Text is saved as tuple in the graphic_object, but as a list when entered.</span>
                        <span class="c1"># so using [] on the graphic_object.coordinates to make it a list.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_coordinates_to_max_size</span><span class="p">([</span><span class="n">graphic_object</span><span class="o">.</span><span class="n">coordinates</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">draw_release</span><span class="p">(</span><span class="n">project_override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">graphic_object</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                                          <span class="n">image_sized_coordinates</span><span class="o">=</span><span class="n">graphic_object</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_coordinates_to_max_size</span><span class="p">(</span><span class="n">graphic_object</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">draw_release</span><span class="p">(</span><span class="n">project_override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">image_sized_coordinates</span><span class="o">=</span><span class="n">graphic_object</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>

                <span class="c1"># Break if the redraw happens in overlay canvas, break after iterating -1 index in the dict.</span>
                <span class="k">if</span> <span class="n">is_overlay</span><span class="p">:</span>
                    <span class="k">return</span>

            <span class="k">if</span> <span class="n">image_index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">graphics_redrawn</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Progress bar fill value.</span>
                <span class="c1"># 0.5+0.3= 0.8 , remaining .2 is reserved for the progress of overlay items.</span>
                <span class="n">progress</span> <span class="o">=</span> <span class="n">graphics_redrawn</span> <span class="o">/</span> <span class="n">total_images_to_redraw</span> <span class="o">*</span> <span class="mf">0.3</span>

                <span class="c1"># the 0.5 progress from the file indexing.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">file_load_window</span><span class="o">.</span><span class="n">update_file_window_progressbar</span><span class="p">(</span><span class="n">progress</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">progress</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">show_next_img</span><span class="p">()</span>  <span class="c1"># Scrolling through the images to get values based on the loaded image.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">force_hide_all_canvas_annotations</span><span class="p">()</span>
        <span class="c1"># seek to the first image.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">show_first_img</span><span class="p">(</span><span class="n">force_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reveal_parent_annotations</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reveal_proxy_annotations</span><span class="p">()</span></div>


<div class="viewcode-block" id="GraphicsManager.peucker_algorithm">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.peucker_algorithm">[docs]</a>
    <span class="k">def</span> <span class="nf">peucker_algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An algorithm that decimates a curve composed of line segments to a similar curve with fewer points.</span>

<span class="sd">        Args:</span>
<span class="sd">            points (tuple|list): Points to decimate.</span>
<span class="sd">            tolerance (float): A float number to control the decimation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of simplified coordinates.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">perpendicular_distance</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">line_start</span><span class="p">,</span> <span class="n">line_end</span><span class="p">):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line_start</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line_end</span>

            <span class="n">numerator</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span> <span class="o">*</span> <span class="n">x1</span><span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="p">((</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>
            <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">points</span>

        <span class="c1"># Find the point with the maximum distance</span>
        <span class="n">max_distance</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">perpendicular_distance</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">distance</span> <span class="o">&gt;</span> <span class="n">max_distance</span><span class="p">:</span>
                <span class="n">max_distance</span> <span class="o">=</span> <span class="n">distance</span>
                <span class="n">max_index</span> <span class="o">=</span> <span class="n">i</span>

        <span class="c1"># If the maximum distance is greater than the tolerance, recursively simplify</span>
        <span class="k">if</span> <span class="n">max_distance</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">:</span>
            <span class="n">left_part</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peucker_algorithm</span><span class="p">(</span><span class="n">points</span><span class="p">[:</span><span class="n">max_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">tolerance</span><span class="p">)</span>
            <span class="n">right_part</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peucker_algorithm</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">max_index</span><span class="p">:],</span> <span class="n">tolerance</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">left_part</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">right_part</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span></div>


<div class="viewcode-block" id="GraphicsManager.create_text_selection_border">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.create_text_selection_border">[docs]</a>
    <span class="k">def</span> <span class="nf">create_text_selection_border</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates four line segments on the canvas to act as a selection border.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">SCALE_BOX_SIZE</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_selection_border</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;#ff66ff&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                                                    <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;gui&quot;</span><span class="p">)</span>

        <span class="c1"># hides the border.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_selection_border</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.select_canvas_item">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.select_canvas_item">[docs]</a>
    <span class="k">def</span> <span class="nf">select_canvas_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">item_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches the clicked item on the canvas. If the item is a text, draw the surrounding border.</span>

<span class="sd">        Args:</span>
<span class="sd">            event(tkinter.Event): Mouse Click event</span>
<span class="sd">            item_id(int):id of the canvas item.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Removes any existing selections.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_text_item_selection</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">item_id</span><span class="p">:</span>  <span class="c1"># if no item_id is provided, fetch the item id closest to the mouse click.</span>
            <span class="n">item_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">find_closest</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">item_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">gettags</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="n">item_tags</span><span class="p">:</span>  <span class="c1"># all text items have the &quot;text&quot; tag.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_text_item</span><span class="p">(</span><span class="n">text_id</span><span class="o">=</span><span class="n">item_id</span><span class="p">)</span>  <span class="c1"># Selects the text item.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_text_drag_offset</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>  <span class="c1"># So that the text items anchor does not snap to the mouse position.</span></div>


<div class="viewcode-block" id="GraphicsManager.select_text_item">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.select_text_item">[docs]</a>
    <span class="k">def</span> <span class="nf">select_text_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enable_scale_slider</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assigns the text item  as the selected_text_item and draws the selection border around it.</span>

<span class="sd">        Args:</span>
<span class="sd">            text_id (int): id of the text item on the canvas.</span>
<span class="sd">            enable_scale_slider: True enables the scale slider that controls the scale of the text. Default True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="n">text_id</span><span class="p">)</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">text_bounds</span>
        <span class="n">border_coordinates</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_selection_border</span><span class="p">,</span> <span class="n">border_coordinates</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">tag_raise</span><span class="p">(</span><span class="s2">&quot;gui&quot;</span><span class="p">)</span>  <span class="c1"># Pushing the border to the top.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_selection_border</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">selection_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span> <span class="o">=</span> <span class="n">text_id</span>

        <span class="k">if</span> <span class="n">enable_scale_slider</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">toggle_image_tools_sliders</span><span class="p">(</span><span class="n">only_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">toggle</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.remove_text_item_selection">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.remove_text_item_selection">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_text_item_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the current text item as the selected_text_item.</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_selection_border</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">toggle_image_tools_sliders</span><span class="p">(</span><span class="n">toggle</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.hide_text_item_selection_border">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.hide_text_item_selection_border">[docs]</a>
    <span class="k">def</span> <span class="nf">hide_text_item_selection_border</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hides the selection border around the selected text item.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_selection_border</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.reveal_text_item_selection_border">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.reveal_text_item_selection_border">[docs]</a>
    <span class="k">def</span> <span class="nf">reveal_text_item_selection_border</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows the selection border around the selected text item.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_text_item</span><span class="p">(</span><span class="n">text_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">is_image_scaling</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_text_repositioning</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_image_repositioning</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_axis_constraint</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="GraphicsManager.annotation_visibility_checker">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.annotation_visibility_checker">[docs]</a>
    <span class="k">def</span> <span class="nf">annotation_visibility_checker</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if annotations are allowed to be displayed on the screen.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Saves time skipping annotation calculations if annotation display is turned off.</span>
        <span class="c1"># If annotation visibility is disabled, skip the method.</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_visibility</span><span class="p">:</span>
                <span class="n">main_result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">main_result</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">wrapper_function</span></div>


<div class="viewcode-block" id="GraphicsManager.check_if_overlay">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.check_if_overlay">[docs]</a>
    <span class="k">def</span> <span class="nf">check_if_overlay</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if current operations are being done on the overlay canvas.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_overlay</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># If Overlay set index to the Overlay graphics index.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_GRAPHICS_INDEX</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># Pushing the images to the top. Since images will be added last due to antialiasing process.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">tag_raise</span><span class="p">(</span><span class="s2">&quot;overlay_img&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">tag_raise</span><span class="p">(</span><span class="s2">&quot;gui&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">wrapper</span></div>


    <span class="c1"># ====================================================</span>

<div class="viewcode-block" id="GraphicsManager.initial_canvas_click">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.initial_canvas_click">[docs]</a>
    <span class="k">def</span> <span class="nf">initial_canvas_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called on the initial mouse click on the canvas. Stores the mouse coordinates and sets the stroke width based on the display mode.</span>

<span class="sd">        Args:</span>
<span class="sd">            event (tkinter.Event):Mouse click event.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">focus_set</span><span class="p">()</span>  <span class="c1"># Focus set on the active canvas.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flush_mouse_events</span><span class="p">()</span>  <span class="c1"># Clears all previously stored mouse click events.</span>

        <span class="k">if</span> <span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># If the current tool used to click on the canvas is the cursor tool,</span>
            <span class="c1"># set ready_to_draw to false and exit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ready_to_draw</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ready_to_draw</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">)</span>

        <span class="c1"># Resize the drawing tool to match proxy proportions.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>  <span class="c1"># if maximized mode use the width as is.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scribble_width</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">stroke_width</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scribble_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_proxy_stroke_width</span><span class="p">()</span>  <span class="c1"># if windowed mode get the proxy width.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>  <span class="c1"># if text insert.</span>
            <span class="k">if</span> <span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># Text insert.</span>

                <span class="c1"># Stores text postion stores the mouse event for the quick text insert using hotkeys.</span>
                <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">stored_text_position</span> <span class="o">=</span> <span class="n">event</span>
                <span class="c1"># -ve means the tkinter will use pixels instead of the font size.(for Pillow)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
                    <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font_size</span> <span class="o">=</span> <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">new_font_pixel_size</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font_size</span> <span class="o">=</span> <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">new_font_pixel_size</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">canvas_text_insert</span><span class="o">.</span><span class="n">reveal_text_insert_window</span><span class="p">()</span>
                <span class="k">return</span>

        <span class="c1"># If the Image is actual sized or zoomed, get the stroke width relative to the zoom. #If the Image is actual sized or zoomed, get the stroke width relative to the zoom.</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;actual&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scribble_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dynamic_stroke_width</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;actual&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;zoomed&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scribble_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dynamic_stroke_width</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;zoomed&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Tools</span><span class="o">.</span><span class="n">shape_fill</span><span class="p">:</span>  <span class="c1"># If the shape_fill check box is enabled. set the fill color as the interior_fill_color.for rectangle and oval.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interior_fill_color</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outline_fill_color</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># only outline</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interior_fill_color</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outline_fill_color</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scribble_width</span> <span class="o">/</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="GraphicsManager.draw_graphics">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.draw_graphics">[docs]</a>
    <span class="k">def</span> <span class="nf">draw_graphics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called on Mouse drag event. Plots a temporary shape using the raw mouse coordinates. Erases the item instantly.</span>

<span class="sd">        Args:</span>
<span class="sd">            event (tkinter.Event):Mouse Drag event.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready_to_draw</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># brush , since the coords are raw a simple drawing can have hundreds of coordinates.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scribble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)),</span> <span class="n">fill</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scribble_width</span><span class="p">,</span> <span class="n">joinstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">capstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span>
                    <span class="n">stipple</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">stipple</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;scribble&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)))</span>

            <span class="k">elif</span> <span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># Eraser</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">erase_graphic</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">stroke_width</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># line</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scribble</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scribble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                                                                   <span class="n">fill</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scribble_width</span><span class="p">,</span>
                                                                   <span class="n">joinstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">capstyle</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">endcap</span><span class="p">,</span>
                                                                   <span class="n">stipple</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">stipple</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;scribble&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scribble</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">))]</span>

            <span class="k">elif</span> <span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># rectangle</span>
                <span class="n">final_point_x</span><span class="p">,</span> <span class="n">final_point_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

                <span class="c1"># Formula for square.</span>
                <span class="k">if</span> <span class="n">Tools</span><span class="o">.</span><span class="n">shape_constraint</span><span class="p">:</span>
                    <span class="n">side_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">final_point_x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">final_point_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">final_point_x</span><span class="p">,</span> <span class="n">final_point_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">side_length</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scribble</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scribble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
                                                                        <span class="n">final_point_x</span> <span class="o">+</span> <span class="n">side_length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
                                                                        <span class="n">final_point_y</span> <span class="o">+</span> <span class="n">side_length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
                                                                        <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interior_fill_color</span><span class="p">,</span>
                                                                        <span class="n">outline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outline_fill_color</span><span class="p">,</span>
                                                                        <span class="n">stipple</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">stipple</span><span class="p">,</span>
                                                                        <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scribble_width</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;scribble&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># modify the rectangle with mouse position.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scribble</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
                                              <span class="n">final_point_x</span> <span class="o">+</span> <span class="n">side_length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
                                              <span class="n">final_point_y</span> <span class="o">+</span> <span class="n">side_length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">),</span>
                                    <span class="p">(</span><span class="n">final_point_x</span> <span class="o">+</span> <span class="n">side_length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
                                     <span class="n">final_point_y</span> <span class="o">+</span> <span class="n">side_length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)]</span>

            <span class="k">elif</span> <span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>  <span class="c1"># oval</span>
                <span class="c1"># self.active_canvas.delete(self.scribble)</span>

                <span class="n">final_point_x</span><span class="p">,</span> <span class="n">final_point_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span>
                    <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                <span class="c1"># Formula for circle.</span>
                <span class="k">if</span> <span class="n">Tools</span><span class="o">.</span><span class="n">shape_constraint</span><span class="p">:</span>
                    <span class="n">side_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">final_point_x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">final_point_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">final_point_x</span><span class="p">,</span> <span class="n">final_point_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">side_length</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scribble</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scribble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">side_length</span><span class="p">,</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">side_length</span><span class="p">,</span>
                                                                   <span class="n">final_point_x</span> <span class="o">+</span> <span class="n">side_length</span><span class="p">,</span>
                                                                   <span class="n">final_point_y</span> <span class="o">+</span> <span class="n">side_length</span><span class="p">,</span>
                                                                   <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interior_fill_color</span><span class="p">,</span>
                                                                   <span class="n">outline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outline_fill_color</span><span class="p">,</span>
                                                                   <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scribble_width</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;scribble&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scribble</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">side_length</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">side_length</span><span class="p">,</span>
                                              <span class="n">final_point_x</span> <span class="o">+</span> <span class="n">side_length</span><span class="p">,</span>
                                              <span class="n">final_point_y</span> <span class="o">+</span> <span class="n">side_length</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">side_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">side_length</span><span class="p">),</span>
                                    <span class="p">(</span><span class="n">final_point_x</span> <span class="o">+</span> <span class="n">side_length</span><span class="p">,</span> <span class="n">final_point_y</span> <span class="o">+</span> <span class="n">side_length</span><span class="p">)]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">scribble_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scribble</span><span class="p">)</span>  <span class="c1"># Appends the raw mouse coordinates to the scribble_list.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.draw_release">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.draw_release">[docs]</a>
    <span class="nd">@check_if_overlay</span>
    <span class="k">def</span> <span class="nf">draw_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">project_override</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">image_sized_coordinates</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called on Mouse release. Fetches the raw coordinates, cleans it scales it to the maximized and windowed size and plots the shape.</span>
<span class="sd">            The coordinates and width are also scaled to match the actual image before saving the graphics_cache object to the dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            event(tkinter.Event):Mouse click release event.</span>
<span class="sd">            text(str,optional): Text, if using the text insert tool.</span>
<span class="sd">            project_override (bool): True if the method is being called from a loaded project protocol. Default False.</span>
<span class="sd">            image_sized_coordinates (list|tuple,optional):Pre-generated coordinates relative to the actual image size.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># p49= proxy tag with 49 as the id of its master, linking them to delete both at same time.</span>
        <span class="c1"># m1=maximized master tag with image index 1</span>
        <span class="c1"># w1=windowed proxy tag with image index 1</span>
        <span class="c1"># Graphics items gets drawn in max window size,even if drawn in windowed mode.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready_to_draw</span> <span class="ow">or</span> <span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># text tool</span>
            <span class="n">current_tool</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="p">(</span><span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">and</span> <span class="n">text</span><span class="p">)</span> <span class="ow">or</span> <span class="n">project_override</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;scribble&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scribble</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span> <span class="ow">or</span> <span class="n">project_override</span><span class="p">:</span>
                    <span class="n">released_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">released_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>  <span class="c1"># upscale the cords to be maxed</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;actual&quot;</span><span class="p">:</span>
                    <span class="n">released_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dynamic_coordinates</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">released_coordinates</span><span class="p">,</span>
                                                                        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;actual&quot;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;zoomed&quot;</span><span class="p">:</span>
                    <span class="n">released_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dynamic_coordinates</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">released_coordinates</span><span class="p">,</span>
                                                                        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;zoomed&quot;</span><span class="p">)</span>

                <span class="n">tags</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;master&quot;</span><span class="p">,</span> <span class="s2">&quot;2d&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">current_tool</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># brush</span>
                    <span class="k">if</span> <span class="n">Tools</span><span class="o">.</span><span class="n">decimate_factor</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">released_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peucker_algorithm</span><span class="p">(</span><span class="n">released_coordinates</span><span class="p">,</span> <span class="n">Tools</span><span class="o">.</span><span class="n">decimate_factor</span><span class="p">)</span>

                    <span class="n">current_stroke</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">released_coordinates</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span><span class="p">,</span>
                                                                    <span class="n">width</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">stroke_width</span><span class="p">,</span>
                                                                    <span class="n">joinstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">capstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span>
                                                                    <span class="n">stipple</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">stipple</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">current_tool</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># line</span>
                    <span class="n">current_stroke</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">released_coordinates</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span><span class="p">,</span>
                                                                    <span class="n">width</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">stroke_width</span><span class="p">,</span>
                                                                    <span class="n">joinstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">capstyle</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">endcap</span><span class="p">,</span>
                                                                    <span class="n">stipple</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">stipple</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">current_tool</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># rectangle</span>
                    <span class="n">current_stroke</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_rectangle</span><span class="p">(</span><span class="n">released_coordinates</span><span class="p">,</span>
                                                                         <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interior_fill_color</span><span class="p">,</span>
                                                                         <span class="n">outline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outline_fill_color</span><span class="p">,</span>
                                                                         <span class="n">width</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">stroke_width</span><span class="p">,</span>
                                                                         <span class="n">stipple</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">stipple</span><span class="p">,</span>
                                                                         <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">current_tool</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>  <span class="c1"># oval</span>
                    <span class="n">current_stroke</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span><span class="n">released_coordinates</span><span class="p">,</span>
                                                                    <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interior_fill_color</span><span class="p">,</span>
                                                                    <span class="n">outline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outline_fill_color</span><span class="p">,</span>
                                                                    <span class="n">width</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">stroke_width</span><span class="p">,</span>
                                                                    <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">current_tool</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># text</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span>
                    <span class="n">selection_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_selection_color</span><span class="p">(</span><span class="n">hex_color</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">Tools</span><span class="o">.</span><span class="n">stipple</span><span class="p">:</span>
                        <span class="n">selection_color</span> <span class="o">=</span> <span class="s2">&quot;#ecff16&quot;</span>
                    <span class="n">tags</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;master&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">released_coordinates</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>  <span class="c1"># text coordinates are saved as tuples.</span>
                        <span class="c1"># Failsafe for slow systems.</span>
                        <span class="k">if</span> <span class="n">released_coordinates</span><span class="p">:</span>
                            <span class="n">released_coordinates</span> <span class="o">=</span> <span class="n">released_coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">error_prompt</span><span class="o">.</span><span class="n">display_error_prompt</span><span class="p">(</span><span class="n">error_msg</span><span class="o">=</span><span class="s2">&quot;Text insertion failed,Try Again.&quot;</span><span class="p">,</span>
                                                                       <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">flush_mouse_events</span><span class="p">()</span>
                            <span class="k">return</span>

                    <span class="n">current_stroke</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_text</span><span class="p">(</span><span class="n">released_coordinates</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                                                                    <span class="n">fill</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span><span class="p">,</span>
                                                                    <span class="n">activefill</span><span class="o">=</span><span class="n">selection_color</span><span class="p">,</span>
                                                                    <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font</span><span class="p">,</span>
                                                                          <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font_size</span><span class="p">),</span>
                                                                    <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;sw&quot;</span><span class="p">)</span>

                <span class="c1"># Graphic object gets created here.</span>
                <span class="c1"># Save time reusing  image size coords from the project file, if not called from project calculate the coords.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">image_sized_coordinates</span><span class="p">:</span>
                    <span class="n">image_sized_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates_to_image_size</span><span class="p">(</span><span class="n">released_coordinates</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">current_stroke</span><span class="p">]</span> <span class="o">=</span> <span class="n">GraphicsCache</span><span class="p">(</span>
                    <span class="n">coordinates</span><span class="o">=</span><span class="n">image_sized_coordinates</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width_to_image_size</span><span class="p">(</span><span class="n">stroke_width</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">stroke_width</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s2">&quot;width&quot;</span><span class="p">),</span>
                    <span class="n">fill_color</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span><span class="p">,</span>
                    <span class="n">shape_fill</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">shape_fill</span><span class="p">,</span>
                    <span class="n">joinstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span>
                    <span class="n">capstyle</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">endcap</span><span class="p">,</span>
                    <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
                    <span class="n">interior_fill_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interior_fill_color</span><span class="p">,</span>
                    <span class="n">outline_fill_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outline_fill_color</span><span class="p">,</span>
                    <span class="n">tool</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span><span class="p">,</span>
                    <span class="n">stipple</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">stipple</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">font_name</span><span class="o">=</span><span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font</span><span class="p">,</span>
                    <span class="n">font_file</span><span class="o">=</span><span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font_file</span><span class="p">,</span>
                    <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width_to_image_size</span><span class="p">(</span><span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font_size</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s2">&quot;font&quot;</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">current_tool</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="c1"># p is for parent, p12 means parent stroke id is 12</span>
                    <span class="n">proxy_tags</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="n">current_stroke</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;w</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;proxy&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">proxy_tags</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="n">current_stroke</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;w</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;2d&quot;</span><span class="p">,</span> <span class="s2">&quot;proxy&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">create_proxy_annotation</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="n">proxy_tags</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">project_override</span><span class="o">=</span><span class="n">project_override</span><span class="p">)</span>

                <span class="c1"># hide large size strokes in windowed mode.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">current_stroke</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;actual&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">scale_item_to_current_scale</span><span class="p">(</span><span class="n">item_id</span><span class="o">=</span><span class="n">current_stroke</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;actual&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;zoomed&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">scale_item_to_current_scale</span><span class="p">(</span><span class="n">item_id</span><span class="o">=</span><span class="n">current_stroke</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;zoomed&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flush_mouse_events</span><span class="p">()</span></div>


<div class="viewcode-block" id="GraphicsManager.erase_graphic">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.erase_graphic">[docs]</a>
    <span class="nd">@check_if_overlay</span>
    <span class="k">def</span> <span class="nf">erase_graphic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">current_item</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes an item from the canvas and deletes the object from the dictionaries.</span>

<span class="sd">        Args:</span>
<span class="sd">            event (tkinter.Event): Mouse event.</span>
<span class="sd">            radius (int): Search radius.</span>
<span class="sd">            current_item(int,optional): Item id of the element in the canvas to remove.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If True delete any given element irrespective of type.Default False.</span>

        <span class="k">if</span> <span class="n">Tools</span><span class="o">.</span><span class="n">stroke_width</span> <span class="o">==</span> <span class="mi">50</span> <span class="ow">and</span> <span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># Maxed out. and eraser tool</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wipe_current_annotations</span><span class="p">()</span>

        <span class="n">delete_mode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">OVERLAY_IMAGE_TAG</span> <span class="o">=</span> <span class="s2">&quot;overlay_img&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_item</span><span class="p">:</span>
            <span class="n">current_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_item</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_item</span> <span class="o">=</span> <span class="n">current_item</span>
            <span class="n">delete_mode</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">gettags</span><span class="p">(</span><span class="n">current_item</span><span class="p">)</span>
        <span class="n">tag_id</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Deletes the 2d drawing along with all stored data. if delete_mode delete any element irrespective of tags.</span>
        <span class="k">if</span> <span class="s2">&quot;2d&quot;</span> <span class="ow">in</span> <span class="n">tag</span> <span class="ow">or</span> <span class="n">delete_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">current_item</span><span class="p">)</span>  <span class="c1"># The selected  item.</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">current_item</span><span class="p">]</span>
                <span class="n">proxy_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">find_withtag</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="n">current_item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">proxy_id</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="n">current_item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># proxy of the parent item.</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># delete the rescaled proxy strokes, and remove parent from graphic dict  as well as delete from screen.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">current_item</span><span class="p">)</span>  <span class="c1"># removes the proxy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tag_id</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>  <span class="c1"># eg p101</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">current_item</span><span class="p">]</span>  <span class="c1"># deletes proxy item from dict</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">tag_id</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>  <span class="c1"># removes the p</span>
        <span class="k">if</span> <span class="n">delete_mode</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_text_item_selection</span><span class="p">()</span></div>


<div class="viewcode-block" id="GraphicsManager.delete_item">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.delete_item">[docs]</a>
    <span class="k">def</span> <span class="nf">delete_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the erase_graphic method with an item id passed.</span>

<span class="sd">        Args:</span>
<span class="sd">            event (tkinter.Event): Keypress event.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">erase_graphic</span><span class="p">(</span><span class="n">current_item</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.wipe_current_annotations">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.wipe_current_annotations">[docs]</a>
    <span class="k">def</span> <span class="nf">wipe_current_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wipes all annotations (including text) drawn on the currently loaded image.</span>
<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">master_items_to_delete</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">master_items_to_delete</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>  <span class="c1"># removes the p</span>

        <span class="n">proxy_items_to_delete</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">proxy_items_to_delete</span><span class="p">:</span>  <span class="c1"># Clearing proxy annotations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">remove_text_item_selection</span><span class="p">()</span></div>


<div class="viewcode-block" id="GraphicsManager.flush_mouse_events">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.flush_mouse_events">[docs]</a>
    <span class="k">def</span> <span class="nf">flush_mouse_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the stored mouse events and temporary coordinates, and sets the state of ready_to_draw to False.</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scribble_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_click</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_text_repositioning</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ready_to_draw</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="GraphicsManager.create_proxy_annotation">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.create_proxy_annotation">[docs]</a>
    <span class="k">def</span> <span class="nf">create_proxy_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">coordinates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">joinstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">stipple</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">capstyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tool</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">project_override</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a proxy version of the drawing to be displayed on the windowed mode.</span>

<span class="sd">        Args:</span>
<span class="sd">            tags:</span>
<span class="sd">            fill_color:</span>
<span class="sd">            coordinates:</span>
<span class="sd">            width:</span>
<span class="sd">            joinstyle:</span>
<span class="sd">            stipple:</span>
<span class="sd">            capstyle:</span>
<span class="sd">            text:</span>
<span class="sd">            tool:</span>
<span class="sd">            project_override (bool): True if method being called from load project protocol.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">coordinates</span><span class="p">:</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">width</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">stroke_width</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">capstyle</span><span class="p">:</span>
            <span class="n">capstyle</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">endcap</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tool</span><span class="p">:</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fill_color</span><span class="p">:</span>
            <span class="n">fill_color</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stipple</span><span class="p">:</span>
            <span class="n">stipple</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">stipple</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span> <span class="ow">or</span> <span class="n">project_override</span><span class="p">:</span>
            <span class="n">scaled_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scaled_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;actual&quot;</span><span class="p">:</span>
            <span class="n">scaled_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dynamic_coordinates</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">scaled_coords</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;actual&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;zoomed&quot;</span><span class="p">:</span>
            <span class="n">scaled_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dynamic_coordinates</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">scaled_coords</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;zoomed&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Tools</span><span class="o">.</span><span class="n">decimate_factor</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">scaled_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peucker_algorithm</span><span class="p">(</span><span class="n">scaled_coords</span><span class="p">,</span> <span class="n">Tools</span><span class="o">.</span><span class="n">decimate_factor</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tool</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Brush</span>
            <span class="n">proxy_drawing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">scaled_coords</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">fill_color</span>
                                                           <span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_proxy_stroke_width</span><span class="p">(),</span>
                                                           <span class="n">joinstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">capstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">stipple</span><span class="o">=</span><span class="n">stipple</span><span class="p">,</span>
                                                           <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tool</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># line</span>
            <span class="n">proxy_drawing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">scaled_coords</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">fill_color</span>
                                                           <span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_proxy_stroke_width</span><span class="p">(),</span>
                                                           <span class="n">joinstyle</span><span class="o">=</span><span class="n">joinstyle</span><span class="p">,</span> <span class="n">capstyle</span><span class="o">=</span><span class="n">capstyle</span><span class="p">,</span> <span class="n">stipple</span><span class="o">=</span><span class="n">stipple</span><span class="p">,</span>
                                                           <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tool</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># rectangle</span>
            <span class="n">proxy_drawing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_rectangle</span><span class="p">(</span><span class="n">scaled_coords</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interior_fill_color</span><span class="p">,</span>
                                                                <span class="n">outline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outline_fill_color</span><span class="p">,</span> <span class="n">stipple</span><span class="o">=</span><span class="n">stipple</span><span class="p">,</span>
                                                                <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_proxy_stroke_width</span><span class="p">(),</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tool</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>  <span class="c1"># oval</span>
            <span class="n">proxy_drawing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span><span class="n">scaled_coords</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interior_fill_color</span><span class="p">,</span>
                                                           <span class="n">outline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outline_fill_color</span><span class="p">,</span>
                                                           <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_proxy_stroke_width</span><span class="p">(),</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tool</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># Insert text</span>
            <span class="n">selection_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_selection_color</span><span class="p">(</span><span class="n">hex_color</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Tools</span><span class="o">.</span><span class="n">stipple</span><span class="p">:</span>
                <span class="n">selection_color</span> <span class="o">=</span> <span class="s2">&quot;#ecff16&quot;</span>

            <span class="n">proxy_drawing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_text</span><span class="p">(</span><span class="n">scaled_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span><span class="p">,</span>
                                                           <span class="n">activefill</span><span class="o">=</span><span class="n">selection_color</span><span class="p">,</span>
                                                           <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font</span><span class="p">,</span>
                                                                 <span class="bp">self</span><span class="o">.</span><span class="n">get_proxy_stroke_width</span><span class="p">(</span>
                                                                     <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font_size</span><span class="p">,</span>
                                                                     <span class="n">is_font_size</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
                                                           <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;sw&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">proxy_drawing</span><span class="p">]</span> <span class="o">=</span> <span class="n">GraphicsCache</span><span class="p">(</span><span class="n">coordinates</span><span class="o">=</span><span class="n">scaled_coords</span><span class="p">,</span>
                                                                       <span class="n">fill_color</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span><span class="p">,</span>
                                                                       <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_proxy_stroke_width</span><span class="p">(),</span>
                                                                       <span class="n">joinstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span>
                                                                       <span class="n">capstyle</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">endcap</span><span class="p">,</span>
                                                                       <span class="n">shape_fill</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">shape_fill</span><span class="p">,</span>
                                                                       <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
                                                                       <span class="n">interior_fill_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interior_fill_color</span><span class="p">,</span>
                                                                       <span class="n">outline_fill_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outline_fill_color</span><span class="p">,</span>
                                                                       <span class="n">tool</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">current_tool</span><span class="p">,</span>
                                                                       <span class="n">stipple</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">stipple</span><span class="p">,</span>
                                                                       <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                                                                       <span class="n">font_name</span><span class="o">=</span><span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font</span><span class="p">,</span>
                                                                       <span class="n">font_file</span><span class="o">=</span><span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font_file</span><span class="p">,</span>
                                                                       <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_proxy_stroke_width</span><span class="p">(</span>
                                                                           <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">selected_font_size</span><span class="p">,</span>
                                                                           <span class="n">is_font_size</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">proxy_drawing</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># If the image is zoomed , match the width and coordinates to match the zoomed image.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;actual&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scale_item_to_current_scale</span><span class="p">(</span><span class="n">item_id</span><span class="o">=</span><span class="n">proxy_drawing</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;actual&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;zoomed&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scale_item_to_current_scale</span><span class="p">(</span><span class="n">item_id</span><span class="o">=</span><span class="n">proxy_drawing</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;zoomed&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.find_item">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.find_item">[docs]</a>
    <span class="k">def</span> <span class="nf">find_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Returns the canvas item closest to the Mouse Click event.</span>

<span class="sd">        Args:</span>
<span class="sd">            event (tkinter.Event): Mouse click event</span>
<span class="sd">            radius (int): Radius to search for. Default 0</span>
<span class="sd">            filter (str): Specific item to look for. eg- &quot;text&quot;</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Id of the canvas item.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selected_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">find_closest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                                                        <span class="n">halo</span><span class="o">=</span><span class="n">radius</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">filter</span><span class="p">:</span>
            <span class="c1"># self.selected_text_item = None</span>
            <span class="k">return</span> <span class="n">selected_item</span>

        <span class="k">elif</span> <span class="nb">filter</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">gettags</span><span class="p">(</span><span class="n">selected_item</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">filter</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span> <span class="o">=</span> <span class="n">selected_item</span>
                <span class="k">return</span> <span class="n">selected_item</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="GraphicsManager.set_text_drag_offset">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.set_text_drag_offset">[docs]</a>
    <span class="k">def</span> <span class="nf">set_text_drag_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the initial position of the text item before repositioning.</span>

<span class="sd">        Args:</span>
<span class="sd">            event(tkinter.Event): Mouse click event.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ready_to_draw</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># if text item is clicked get its bounding box.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_item</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                <span class="n">current_item_bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">)</span>
                <span class="c1"># Since the anchor is &quot;sw&quot;  we use x1 and y2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text_offset_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">current_item_bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># x1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text_offset_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">current_item_bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># y2</span>
            <span class="k">return</span></div>


<div class="viewcode-block" id="GraphicsManager.reposition_text_item">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.reposition_text_item">[docs]</a>
    <span class="k">def</span> <span class="nf">reposition_text_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">constraint</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reposition the text item based on coordinates from the mouse drag event.</span>

<span class="sd">        Args:</span>
<span class="sd">            event (tkinter.Event): Mouse Drag event.</span>
<span class="sd">            constraint (bool): True constraints the text to an axis. False allows free repositioning.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_text_repositioning</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hide_text_item_selection_border</span><span class="p">()</span>
            <span class="c1"># Offset so that text anchor won&#39;t snap to mouse position.</span>
            <span class="n">current_mousex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">current_mousey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

            <span class="n">new_x</span> <span class="o">=</span> <span class="n">current_mousex</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_offset_x</span>
            <span class="n">new_y</span> <span class="o">=</span> <span class="n">current_mousey</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_offset_y</span>

            <span class="k">if</span> <span class="n">constraint</span><span class="p">:</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">current_mousex</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">dy</span> <span class="o">=</span> <span class="n">current_mousey</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_axis_constraint</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># None means no X or Y.</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dy</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">x_axis_constraint</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">x_axis_constraint</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_axis_constraint</span><span class="p">:</span>
                    <span class="n">new_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_offset_y</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">,</span> <span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_offset_x</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">,</span> <span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">,</span> <span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span><span class="p">))</span>

            <span class="n">event</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">new_x</span>
            <span class="n">event</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">new_y</span>
            <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">stored_text_position</span> <span class="o">=</span> <span class="n">event</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_text_item_coords</span><span class="p">()</span></div>


<div class="viewcode-block" id="GraphicsManager.update_text_item_coords">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.update_text_item_coords">[docs]</a>
    <span class="nd">@check_if_overlay</span>
    <span class="k">def</span> <span class="nf">update_text_item_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the text item coordinates in the data dictionaries after conversion.</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_text_repositioning</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="c1"># Raw coordinates of current window mode.</span>
            <span class="n">moved_text_bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">)</span>
            <span class="n">new_coords</span> <span class="o">=</span> <span class="n">moved_text_bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moved_text_bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># (x1,y2)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
                <span class="n">proxy_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">find_withtag</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">new_proxy_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">new_coords</span><span class="p">,</span>
                                                          <span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">scale_item</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">,</span> <span class="n">new_proxy_coords</span><span class="p">)</span>
                <span class="c1"># Converting the max coordinates to image scale.</span>
                <span class="n">image_sized_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates_to_image_size</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">new_coords</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">image_sized_coords</span>
                <span class="c1"># Updates the proxy with scaled down coordinates from max view.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">proxy_id</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">new_proxy_coords</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">gettags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">new_max_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">new_coords</span><span class="p">,</span>
                                                        <span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">scale_item</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>

                <span class="c1"># Converting the max cords to proxy cords to get near pixel perfect accuracy.</span>
                <span class="n">new_proxy_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">new_max_coords</span><span class="p">,</span>
                                                          <span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">scale_item</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="n">new_max_coords</span><span class="p">)</span>
                <span class="c1"># update the proxy data as is.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">new_proxy_coords</span>
                <span class="c1"># Converting the max coordinates to image scale.</span>
                <span class="n">image_sized_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates_to_image_size</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">new_max_coords</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">image_sized_coords</span></div>


        <span class="c1"># self.select_text_item(text_id=self.selected_text_item)</span>

<div class="viewcode-block" id="GraphicsManager.update_text_item_scale">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.update_text_item_scale">[docs]</a>
    <span class="nd">@check_if_overlay</span>
    <span class="k">def</span> <span class="nf">update_text_item_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">increment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the scale of the selected text item using the provided value.</span>

<span class="sd">        Args:</span>
<span class="sd">            value (float, optional): A multiplier number.</span>
<span class="sd">            increment(str, optional):&quot;+&quot; adds +1 to the current scale, &quot;-&quot; subtracts -1 from the current scale., optional</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MIN_TEXT_SIZE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
                <span class="n">parent_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span>
                <span class="n">proxy_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">find_withtag</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">proxy_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">gettags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">parent_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

            <span class="n">current_text_item_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">parent_id</span><span class="p">]</span>
            <span class="n">current_font_family</span> <span class="o">=</span> <span class="n">current_text_item_object</span><span class="o">.</span><span class="n">font_name</span>

            <span class="n">current_font_size</span> <span class="o">=</span> <span class="n">current_text_item_object</span><span class="o">.</span><span class="n">font_size</span>
            <span class="n">max_font_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_width_to_max_size</span><span class="p">(</span><span class="n">stroke_width</span><span class="o">=</span><span class="n">current_font_size</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s2">&quot;font&quot;</span><span class="p">)</span>

            <span class="n">proxy_font_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_proxy_stroke_width</span><span class="p">(</span><span class="n">stroke_width</span><span class="o">=</span><span class="n">max_font_size</span><span class="p">,</span> <span class="n">is_font_size</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_text_scaling</span><span class="p">:</span>
                <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">stored_text_size</span> <span class="o">=</span> <span class="n">max_font_size</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_text_scaling</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">new_font_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">stored_text_size</span> <span class="o">*</span> <span class="n">value</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">increment</span><span class="p">:</span>
                <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">stored_text_size</span> <span class="o">=</span> <span class="n">max_font_size</span>
                <span class="c1"># Might be Confusing, the - and + are flipped because tkinter represents fonts in - values(pixel size).</span>
                <span class="c1"># so font size of -52 needs to be -53 to be larger.</span>
                <span class="k">if</span> <span class="n">increment</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span>
                    <span class="n">new_font_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">stored_text_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">increment</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
                    <span class="n">new_font_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">stored_text_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_font_size</span> <span class="o">=</span> <span class="n">MIN_TEXT_SIZE</span>

            <span class="n">new_font_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">MIN_TEXT_SIZE</span><span class="p">,</span> <span class="n">new_font_size</span><span class="p">)</span>
            <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">new_font_pixel_size</span> <span class="o">=</span> <span class="n">new_font_size</span>

            <span class="n">new_proxy_font_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_proxy_stroke_width</span><span class="p">(</span><span class="n">new_font_size</span><span class="p">,</span> <span class="n">is_font_size</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># &#39;Arial Unicode MS&#39; # -33 ,negative means pixel size instead of font.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">parent_id</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="n">current_font_family</span><span class="p">,</span>
                                                           <span class="n">new_font_size</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="n">current_font_family</span><span class="p">,</span>
                                                          <span class="n">new_proxy_font_size</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">parent_id</span><span class="p">]</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width_to_image_size</span><span class="p">(</span>
                <span class="n">TextInsertWindow</span><span class="o">.</span><span class="n">new_font_pixel_size</span><span class="p">,</span>
                <span class="n">item</span><span class="o">=</span><span class="s2">&quot;font&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">proxy_id</span><span class="p">]</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">new_proxy_font_size</span>
            <span class="c1"># Redraw the bounding</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_text_item</span><span class="p">(</span><span class="n">text_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">,</span> <span class="n">enable_scale_slider</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.update_text_color">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.update_text_color">[docs]</a>
    <span class="nd">@check_if_overlay</span>
    <span class="k">def</span> <span class="nf">update_text_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the color of the clicked text item.</span>

<span class="sd">        Args:</span>
<span class="sd">            event (tkinter.Event):Mouse click event</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_item</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
                <span class="n">parent_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span>
                <span class="n">proxy_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">find_withtag</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">proxy_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">gettags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_text_item</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">parent_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

            <span class="n">selection_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_selection_color</span><span class="p">(</span><span class="n">hex_color</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span><span class="p">)</span>

            <span class="c1"># Updates the text color in all graphic_data and proxy_data.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">parent_id</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span><span class="p">,</span> <span class="n">activefill</span><span class="o">=</span><span class="n">selection_color</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span><span class="p">,</span> <span class="n">activefill</span><span class="o">=</span><span class="n">selection_color</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">parent_id</span><span class="p">]</span><span class="o">.</span><span class="n">fill_color</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">proxy_id</span><span class="p">]</span><span class="o">.</span><span class="n">fill_color</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">fill_color</span>
            <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="GraphicsManager.force_hide_all_canvas_annotations">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.force_hide_all_canvas_annotations">[docs]</a>
    <span class="k">def</span> <span class="nf">force_hide_all_canvas_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hides all drawing and text annotations on the image canvas.</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Hide all canvas items including the image.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
        <span class="c1"># Reveal only the image.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.hide_parent_annotations">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.hide_parent_annotations">[docs]</a>
    <span class="nd">@annotation_visibility_checker</span>
    <span class="k">def</span> <span class="nf">hide_parent_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hide_current</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>  <span class="c1"># Hide the graphic objects on screen</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hides the annotations displayed on the maximized display mode.</span>

<span class="sd">        Args:</span>
<span class="sd">            hide_current (bool): If True hide the annotations on the currently displayed image index too. Default False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hide_current</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">last_viewed_image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">last_viewed_image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.reveal_parent_annotations">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.reveal_parent_annotations">[docs]</a>
    <span class="nd">@annotation_visibility_checker</span>
    <span class="k">def</span> <span class="nf">reveal_parent_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays the annotations of the current image index displayed on the maximized display mode.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.hide_proxy_annotations">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.hide_proxy_annotations">[docs]</a>
    <span class="nd">@annotation_visibility_checker</span>
    <span class="k">def</span> <span class="nf">hide_proxy_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hide_current</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hides the annotations displayed on the windowed display mode.</span>

<span class="sd">        Args:</span>
<span class="sd">            hide_current (bool): If True hide the annotations on the currently displayed image index too. Default False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Hides all objects with the drawing tag. found tcl method is more efficient rather than python loop.</span>
        <span class="k">if</span> <span class="n">hide_current</span><span class="p">:</span>
            <span class="c1"># Make it hide all proxies to avoid any bugs later.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;w</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">last_viewed_image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;w</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Hide only the previous</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;w</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">last_viewed_image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.reveal_proxy_annotations">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.reveal_proxy_annotations">[docs]</a>
    <span class="nd">@annotation_visibility_checker</span>
    <span class="k">def</span> <span class="nf">reveal_proxy_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays the annotations of the current image index displayed on the windowed display mode.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;w</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span></div>


    <span class="c1"># If no coordinates, stroke_width are provided the method uses the attributes of the currently plotted element.</span>

<div class="viewcode-block" id="GraphicsManager.get_proxy_stroke_width">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.get_proxy_stroke_width">[docs]</a>
    <span class="k">def</span> <span class="nf">get_proxy_stroke_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stroke_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_font_size</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the Canvas size difference between maximized and windowed mode and uses that value to adjust the stroke width/font size accordingly.</span>

<span class="sd">        Args:</span>
<span class="sd">            stroke_width (float, optional): Width of the stroke to be converted to match the proxy window.</span>
<span class="sd">            is_font_size (bool): True when the passed coordinates represent the font size.</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stroke_width</span><span class="p">:</span>
            <span class="n">current_stroke_width</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">stroke_width</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_stroke_width</span> <span class="o">=</span> <span class="n">stroke_width</span>

        <span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">windowed_canvas_size</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">old_width</span><span class="p">,</span> <span class="n">old_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_canvas_size</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># directly calculate the image frame size on maxed mode.</span>
            <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">height</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_maxed</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_maxed</span> <span class="o">*</span> <span class="n">aspect_ratio</span><span class="p">))</span>
            <span class="n">height</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_maxed</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_maxed</span> <span class="o">/</span> <span class="n">aspect_ratio</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_canvas_size</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>
            <span class="n">old_width</span><span class="p">,</span> <span class="n">old_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_canvas_size</span>

        <span class="n">max_scaling_factor</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">new_width</span> <span class="o">/</span> <span class="n">old_width</span><span class="p">,</span> <span class="n">new_height</span> <span class="o">/</span> <span class="n">old_height</span><span class="p">)</span>
        <span class="n">float_stroke_width</span> <span class="o">=</span> <span class="n">current_stroke_width</span> <span class="o">*</span> <span class="n">max_scaling_factor</span>

        <span class="k">if</span> <span class="n">is_font_size</span><span class="p">:</span>  <span class="c1"># If font size, simply round.</span>
            <span class="k">if</span> <span class="n">float_stroke_width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">float_stroke_width</span> <span class="o">=</span> <span class="o">-</span><span class="n">float_stroke_width</span>
            <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">float_stroke_width</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">float_stroke_width</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">adjusted_stroke_width</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adjusted_stroke_width</span> <span class="o">=</span> <span class="n">float_stroke_width</span>
            <span class="c1">#</span>

        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">adjusted_stroke_width</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.scale_coordinates">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.scale_coordinates">[docs]</a>
    <span class="nd">@annotation_visibility_checker</span>
    <span class="k">def</span> <span class="nf">scale_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinate_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scale_item</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">round_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scale the coordinates of the canvas item to match the specified display mode.</span>

<span class="sd">        Args:</span>
<span class="sd">            coordinate_list (list|tuple,optional):Coordinates to be scaled.</span>
<span class="sd">            scale_mode (str): &quot;+&quot; Scales the coordinates from window size to maximized size. &quot;-&quot; Scales the other way.</span>
<span class="sd">            scale_item (str): Item to be scaled, items like &quot;text&quot;,&quot;images&quot; have only a single x,y coordinate and require different calculations.</span>
<span class="sd">            round_ (bool):True rounds the output into an integer. Default False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (list|tuple):The scaled coordinates.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">coordinate_list</span><span class="p">:</span>
            <span class="n">coordinate_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span>
        <span class="k">if</span> <span class="n">scale_mode</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span>  <span class="c1"># scale coordinates in windowed mode to match default Maximized size.</span>
            <span class="n">old_width</span><span class="p">,</span> <span class="n">old_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_windowed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_windowed</span>
            <span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_maxed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_maxed</span>
        <span class="k">elif</span> <span class="n">scale_mode</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>  <span class="c1"># scaling default cordinates to proxy windowed mode from maximized mode.</span>
            <span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_windowed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_windowed</span>
            <span class="n">old_width</span><span class="p">,</span> <span class="n">old_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_maxed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_maxed</span>

        <span class="n">scale_x</span> <span class="o">=</span> <span class="n">new_width</span> <span class="o">/</span> <span class="n">old_width</span>
        <span class="n">scale_y</span> <span class="o">=</span> <span class="n">new_height</span> <span class="o">/</span> <span class="n">old_height</span>
        <span class="n">coord_scale_factor</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">scale_x</span><span class="p">,</span> <span class="n">scale_y</span><span class="p">)</span>

        <span class="c1"># Since text only has single tuple (x,y) coordinates.</span>

        <span class="k">if</span> <span class="n">scale_item</span> <span class="o">==</span> <span class="s2">&quot;image&quot;</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">coordinate</span> <span class="o">*</span> <span class="n">coord_scale_factor</span> <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coordinate_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">round_</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">scale_item</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">coordinate</span> <span class="o">*</span> <span class="n">coord_scale_factor</span> <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coordinate_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">round_</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">scaled_coordinates</span> <span class="o">=</span> <span class="p">[((</span><span class="n">x</span> <span class="o">*</span> <span class="n">coord_scale_factor</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">coord_scale_factor</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">coordinate_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">scaled_coordinates</span></div>


<div class="viewcode-block" id="GraphicsManager.get_dynamic_stroke_width">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.get_dynamic_stroke_width">[docs]</a>
    <span class="nd">@annotation_visibility_checker</span>
    <span class="k">def</span> <span class="nf">get_dynamic_stroke_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a stroke width that matches the zoomed image size.</span>

<span class="sd">        Args:</span>
<span class="sd">            mode (str): Type of zoom, &quot;actual&quot;, &quot;zoomed&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float:Scaled width size that matches the zoomed image size.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;actual&quot;</span><span class="p">:</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">resized_ld_img</span><span class="o">.</span><span class="n">width</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;zoomed&quot;</span><span class="p">:</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">scale_factor</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scribble_width</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.get_dynamic_coordinates">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.get_dynamic_coordinates">[docs]</a>
    <span class="nd">@annotation_visibility_checker</span>
    <span class="k">def</span> <span class="nf">get_dynamic_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">coordinate_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the scaled coordinates that matches the  size of the zoomed image.</span>

<span class="sd">        Args:</span>
<span class="sd">            mode (str): Mode of the displayed image. &quot;actual&quot; or &quot;zoomed&quot;.</span>
<span class="sd">            coordinate_list (list|tuple, optional):Coordinates to scale.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Scaled Coordinates that matches the zoomed image size.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">coordinate_list</span><span class="p">:</span>
            <span class="n">coordinate_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords_list</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;actual&quot;</span><span class="p">:</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">resized_ld_img</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">width</span>
            <span class="n">scaled_coordinates</span> <span class="o">=</span> <span class="p">[((</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">coordinate_list</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;zoomed&quot;</span><span class="p">:</span>  <span class="c1"># Compares the difference of the displayed image with the zoomed image size.</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">resized_ld_img</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">zoomed_ld_img</span><span class="o">.</span><span class="n">width</span>
            <span class="n">scaled_coordinates</span> <span class="o">=</span> <span class="p">[((</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">coordinate_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">scaled_coordinates</span></div>


<div class="viewcode-block" id="GraphicsManager.scale_item_to_current_scale">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.scale_item_to_current_scale">[docs]</a>
    <span class="nd">@annotation_visibility_checker</span>
    <span class="k">def</span> <span class="nf">scale_item_to_current_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scale an item in the canvas to match the current zoom level of the image.</span>

<span class="sd">        Args:</span>
<span class="sd">            item_id (int):id of the canvas item to be scaled to match the zoomed image size.</span>
<span class="sd">             mode (str): Mode of the displayed image. &quot;actual&quot; or &quot;zoomed&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;actual&quot;</span><span class="p">:</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">resized_ld_img</span><span class="o">.</span><span class="n">width</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;zoomed&quot;</span><span class="p">:</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">scale_factor</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">item_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
            <span class="n">current_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="p">][</span><span class="n">item_id</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">item_id</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_width_to_max_size</span><span class="p">()</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="p">][</span><span class="n">item_id</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">item_id</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="n">current_item</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">))</span></div>


<div class="viewcode-block" id="GraphicsManager.coordinates_to_image_size">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.coordinates_to_image_size">[docs]</a>
    <span class="k">def</span> <span class="nf">coordinates_to_image_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinate_list</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">round_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Scales the coordinates to match the actual image size. Coordinates are stored in the original image size for file saving and loading purposes.</span>

<span class="sd">             Args:</span>
<span class="sd">                 coordinate_list (tuple|list ): Coordinates to be converted to the size of the image.</span>
<span class="sd">                 item (str, optional): Canvas item type. &quot;text&quot; if the item type is text, else None.</span>
<span class="sd">                 round_(bool,optional): Ignored in this method, Used in childclass to round floats to integer.</span>

<span class="sd">             Returns:</span>
<span class="sd">                  Coordinates that matches the size of the loaded image.</span>

<span class="sd">             &quot;&quot;&quot;</span>

        <span class="c1"># Used round_ here to properly override the childclass.</span>

        <span class="n">old_width</span><span class="p">,</span> <span class="n">old_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_canvas_size</span>

        <span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">size</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">new_width</span> <span class="o">/</span> <span class="n">old_width</span>

        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">coordinate</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coordinate_list</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">true_coordinates</span> <span class="o">=</span> <span class="p">[((</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">coordinate_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">true_coordinates</span></div>


<div class="viewcode-block" id="GraphicsManager.image_coordinates_to_max_size">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.image_coordinates_to_max_size">[docs]</a>
    <span class="k">def</span> <span class="nf">image_coordinates_to_max_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinate_list</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">round_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the coordinates of the canvas item from the actual image size to maximized window mode. Used with Load and Save.</span>

<span class="sd">        Args:</span>
<span class="sd">            coordinate_list (tuple|list ): Coordinates to be converted to the size of the image.</span>
<span class="sd">            item (str, optional): Canvas item type. &quot;text&quot; if the item type is text, else None.</span>
<span class="sd">            round_ (bool):  True rounds the values to the closest integer. Default False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Coordinates that matches the image size in the maximized windowed mode.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">old_width</span><span class="p">,</span> <span class="n">old_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">size</span>
        <span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_canvas_size</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">new_width</span> <span class="o">/</span> <span class="n">old_width</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">coordinate</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coordinate_list</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">maximized_coordinates</span> <span class="o">=</span> <span class="p">[((</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">coordinate_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">maximized_coordinates</span></div>


<div class="viewcode-block" id="GraphicsManager.width_to_image_size">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.width_to_image_size">[docs]</a>
    <span class="k">def</span> <span class="nf">width_to_image_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stroke_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scales the width to match the actual image size. Width is saved in the original image size for file saving and loading purposes.</span>

<span class="sd">        Args:</span>
<span class="sd">            stroke_width(float|int,optional): Stroke to be converted to match the actual size of the image.</span>
<span class="sd">            item (str, optional): Canvas item type. &quot;font&quot; if the item type is text, else None.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Width or Font size that matches the size of the loaded image.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">stroke_width</span><span class="p">:</span>
            <span class="n">current_stroke_width</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">stroke_width</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_stroke_width</span> <span class="o">=</span> <span class="n">stroke_width</span>

        <span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">size</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">old_width</span><span class="p">,</span> <span class="n">old_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_canvas_size</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">height</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_maxed</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_maxed</span> <span class="o">*</span> <span class="n">aspect_ratio</span><span class="p">))</span>
            <span class="n">height</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_maxed</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_maxed</span> <span class="o">/</span> <span class="n">aspect_ratio</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_canvas_size</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>
            <span class="n">old_width</span><span class="p">,</span> <span class="n">old_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_canvas_size</span>

        <span class="n">width_scale_factor</span> <span class="o">=</span> <span class="n">new_width</span> <span class="o">/</span> <span class="n">old_width</span>

        <span class="n">float_stroke_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_stroke_width</span> <span class="o">*</span> <span class="n">width_scale_factor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;font&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">float_stroke_width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># incase bug causes the -ve to +ve</span>
                <span class="n">float_stroke_width</span> <span class="o">=</span> <span class="o">-</span><span class="n">float_stroke_width</span>
            <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">float_stroke_width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">float_stroke_width</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">adjusted_stroke_width</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adjusted_stroke_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">float_stroke_width</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">adjusted_stroke_width</span></div>


<div class="viewcode-block" id="GraphicsManager.convert_width_to_max_size">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.convert_width_to_max_size">[docs]</a>
    <span class="k">def</span> <span class="nf">convert_width_to_max_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stroke_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the width of the canvas item from the actual image size to maximized window mode. Used with Load and Save.</span>

<span class="sd">        Args:</span>
<span class="sd">           stroke_width (float|int,optional ): Width or font size to be converted to the size of the image.</span>
<span class="sd">           item (str, optional): Canvas item type. &quot;font&quot; if the item type is text, else None.</span>

<span class="sd">        Returns:</span>
<span class="sd">           Width that matches the image size in the maximized windowed mode.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Since the width is saved to match the actual image in the main cache, resizing here to match the viewport.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stroke_width</span><span class="p">:</span>
            <span class="n">width_from_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width_to_image_size</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">width_from_image</span> <span class="o">=</span> <span class="n">stroke_width</span>

        <span class="n">old_width</span><span class="p">,</span> <span class="n">old_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">size</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_canvas_size</span>
        <span class="k">except</span><span class="p">:</span>  <span class="c1"># Failsafe incase  no max size found</span>
            <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">height</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_maxed</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_maxed</span> <span class="o">*</span> <span class="n">aspect_ratio</span><span class="p">))</span>
            <span class="n">height</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_maxed</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_maxed</span> <span class="o">/</span> <span class="n">aspect_ratio</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_canvas_size</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>
            <span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_canvas_size</span>

        <span class="n">width_scale_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_width</span> <span class="o">/</span> <span class="n">old_width</span><span class="p">)</span>
        <span class="n">float_stroke_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">width_from_image</span> <span class="o">*</span> <span class="n">width_scale_factor</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;font&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">float_stroke_width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">float_stroke_width</span> <span class="o">=</span> <span class="o">-</span><span class="n">float_stroke_width</span>
            <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">float_stroke_width</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">float_stroke_width</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">adjusted_stroke_width</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adjusted_stroke_width</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">float_stroke_width</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">adjusted_stroke_width</span></div>


<div class="viewcode-block" id="GraphicsManager.scale_to_actual_size">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.scale_to_actual_size">[docs]</a>
    <span class="k">def</span> <span class="nf">scale_to_actual_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scales the visible items on the canvas visually to match the Actual Image size in viewport.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># finding how much the image has been scaled</span>
        <span class="n">scale_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">resized_ld_img</span><span class="o">.</span><span class="n">width</span>
        <span class="n">scale_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">resized_ld_img</span><span class="o">.</span><span class="n">height</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">scale_x</span><span class="p">,</span> <span class="n">scale_y</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span>
                                                  <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_width_to_max_size</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale_to_reset</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span>  <span class="c1"># maximized</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;w</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale_to_reset</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span>  <span class="c1"># windowed</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">actual_scale_btn</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Actual Scale: ON&quot;</span><span class="p">,</span> <span class="n">fg_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">TOP_BUTTON_FG_ACTIVE</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.reset_actual_size">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.reset_actual_size">[docs]</a>
    <span class="k">def</span> <span class="nf">reset_actual_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets the visual scale of items on the canvas from actual scale to the default scale of the image in the viewport.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">resized_ld_img</span><span class="o">.</span><span class="n">width</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_to_reset</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">scale_factor</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_width_to_max_size</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">width</span><span class="p">))</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_to_reset</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;w</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">scale_factor</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_to_reset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">actual_scale_btn</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Actual Scale: OFF&quot;</span><span class="p">,</span> <span class="n">fg_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">TOP_BUTTON_FG</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsManager.scale_to_zoomed_size">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.scale_to_zoomed_size">[docs]</a>
    <span class="k">def</span> <span class="nf">scale_to_zoomed_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">lock_zoom</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scales the visible items on the canvas visually to match the Zoomed image size in viewport.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">lock_zoom</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span>
                <span class="n">scale_factor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">1.5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">scale_factor</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">convert_width_to_max_size</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">scale_factor</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zoom_to_reset</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span>  <span class="c1"># maximized</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;w</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">scale_factor</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zoom_to_reset</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span>  <span class="c1"># windowed</span></div>


<div class="viewcode-block" id="GraphicsManager.reset_zoomed_size">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.reset_zoomed_size">[docs]</a>
    <span class="k">def</span> <span class="nf">reset_zoomed_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets the visual scale of items on the canvas from the zoomed size to the default scale of the image in the viewport.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if not zoom_lock:</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">scale_factor</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_to_reset</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_width_to_max_size</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">width</span><span class="p">)))</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_to_reset</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;w</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">zoom_to_reset</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="GraphicsManager.hide_current_text_items">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.hide_current_text_items">[docs]</a>
    <span class="k">def</span> <span class="nf">hide_current_text_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hides the text items on the canvas.</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">proxy_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_index</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span></div>


    <span class="c1"># ------Color Conversion---------------</span>
<div class="viewcode-block" id="GraphicsManager.hex_to_rgb">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.hex_to_rgb">[docs]</a>
    <span class="k">def</span> <span class="nf">hex_to_rgb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hex_color</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a color from Hex to RGB values</span>

<span class="sd">        Args:</span>
<span class="sd">            hex_color (str): Hex Color code to be converted into RGB values</span>

<span class="sd">        Returns:</span>
<span class="sd">                tuple:RGB values as a tuple.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">hex_color</span> <span class="o">=</span> <span class="n">hex_color</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">hex_color</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">rgb</span></div>


<div class="viewcode-block" id="GraphicsManager.get_selection_color">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsManager.get_selection_color">[docs]</a>
    <span class="k">def</span> <span class="nf">get_selection_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hex_color</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the given hex value to see if it&#39;s on the brighter or darker side, then returns a contrasting color close to the given color range.</span>

<span class="sd">       Args:</span>
<span class="sd">            hex_color (str): Hex color.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Brighter or Darker tone of the given Hex color.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">OFFSET</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">rgb_tuple</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hex_to_rgb</span><span class="p">(</span><span class="n">hex_color</span><span class="p">)</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rgb_tuple</span><span class="p">)</span>
        <span class="n">adjusted_color</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">OFFSET</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span> <span class="k">if</span> <span class="n">max_value</span> <span class="o">&gt;</span> <span class="mi">128</span> <span class="k">else</span> <span class="nb">min</span><span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="n">OFFSET</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span>
            <span class="n">value</span> <span class="ow">in</span> <span class="n">rgb_tuple</span><span class="p">]</span>

        <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">adjusted_color</span>
        <span class="c1"># RGB to HEX conversion.</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;#</span><span class="si">{</span><span class="n">r</span><span class="si">:</span><span class="s1">02x</span><span class="si">}{</span><span class="n">g</span><span class="si">:</span><span class="s1">02x</span><span class="si">}{</span><span class="n">b</span><span class="si">:</span><span class="s1">02x</span><span class="si">}</span><span class="s1">&#39;</span></div>
</div>



<div class="viewcode-block" id="OverlayGraphicsManager">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager">[docs]</a>
<span class="k">class</span> <span class="nc">OverlayGraphicsManager</span><span class="p">(</span><span class="n">GraphicsManager</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Child Class that handles the creation and display of graphic elements and overlay images on the Overlay Canvas.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">is_overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialising the Class with a given canvas.</span>

<span class="sd">        Args:</span>
<span class="sd">            app: Tkinter main app</span>
<span class="sd">            canvas: Overlay Canvas</span>
<span class="sd">            is_overlay (bool): True if the canvas is the overlay canvas. Default True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">is_overlay</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_WIDTH</span> <span class="o">=</span> <span class="mi">1920</span>  <span class="c1"># A Ghost image to make sure that the coordinates are saved consistently.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_HEIGHT</span> <span class="o">=</span> <span class="mi">1080</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imported_overlay_image_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_image_repositioning</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_image_scaling</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stored_image_size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_overlay_image_selection_border</span><span class="p">()</span>

<div class="viewcode-block" id="OverlayGraphicsManager.draw_graphic_elements_from_project_file">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.draw_graphic_elements_from_project_file">[docs]</a>
    <span class="k">def</span> <span class="nf">draw_graphic_elements_from_project_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the Overlay image index in the project file for any overlay images and adds the images and applies the saved transformations to it.</span>
<span class="sd">        Unpacks the loaded_graphics_data_dict and based on the tool used, mimics the events that happens during the normal drawing.</span>

<span class="sd">        Args:</span>
<span class="sd">            is_overlay(bool):True, Argument has no use in child method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loaded_graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_IMAGES_INDEX</span><span class="p">]:</span>  <span class="c1"># checking for images.</span>
            <span class="k">for</span> <span class="n">item_id</span><span class="p">,</span> <span class="n">image_element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loaded_graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_IMAGES_INDEX</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="n">image_element</span><span class="o">.</span><span class="n">coordinates</span>
                <span class="n">max_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewport_size_from_absolute_overlay_size</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
                <span class="n">proxy_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="n">max_coordinates</span><span class="p">,</span> <span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">scale_item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>

                <span class="n">size</span> <span class="o">=</span> <span class="n">image_element</span><span class="o">.</span><span class="n">size</span>
                <span class="n">max_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewport_size_from_absolute_overlay_size</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">round_</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">proxy_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">scale_item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">round_</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># add the image to the overlay. Skip if overlay image not found.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_image_to_overlay_canvas</span><span class="p">(</span><span class="n">image_path</span><span class="o">=</span><span class="n">image_element</span><span class="o">.</span><span class="n">image_path</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="c1"># Mimicking the image transform operations</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scale_overlay_image</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">max_size</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reposition_overlay_image</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">max_coordinates</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scale_overlay_image</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">proxy_size</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reposition_overlay_image</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">proxy_coordinates</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">rotate_overlay_image</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">image_element</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">change_overlay_image_opacity</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="n">image_element</span><span class="o">.</span><span class="n">opacity</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loaded_graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_GRAPHICS_INDEX</span><span class="p">]:</span>  <span class="c1"># Calls the parent method.</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">draw_graphic_elements_from_project_file</span><span class="p">(</span><span class="n">is_overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.create_overlay_image_selection_border">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.create_overlay_image_selection_border">[docs]</a>
    <span class="k">def</span> <span class="nf">create_overlay_image_selection_border</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots a six segmented line segment to act as a selection border while selecting the overlay images.</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_selection_border</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;#20C9FF&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                                                     <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;gui&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_selection_border</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.add_image_to_overlay_canvas">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.add_image_to_overlay_canvas">[docs]</a>
    <span class="k">def</span> <span class="nf">add_image_to_overlay_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Places the imported image in the overlay canvas. If the imported image and the currently viewed image size is the same, the imported image is scaled to fit.</span>

<span class="sd">        Args:</span>
<span class="sd">            image_path (str): File path for the imported image.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imported_overlay_ld_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">)</span>

        <span class="n">imported_image_width</span><span class="p">,</span> <span class="n">imported_image_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imported_overlay_ld_img</span><span class="o">.</span><span class="n">size</span>

        <span class="c1"># If the imported image matches the current image in height or width, placing them without any shrinking.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">width</span> <span class="o">==</span> <span class="n">imported_image_width</span><span class="p">:</span>  <span class="c1">#</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">resized_ld_img</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">width</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">height</span> <span class="o">==</span> <span class="n">imported_image_height</span><span class="p">:</span>  <span class="c1">#</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">resized_ld_img</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">height</span>

        <span class="c1"># If the Image size does not match the background, shrink it to 1/2 size of the canvas.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">width_scale_factor</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">resized_ld_img</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">imported_image_width</span>
            <span class="n">height_scale_factor</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">resized_ld_img</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">imported_image_height</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">width_scale_factor</span><span class="p">,</span> <span class="n">height_scale_factor</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resized_imported_overlay_ld_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imported_overlay_ld_img</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">imported_image_width</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">),</span>
             <span class="nb">int</span><span class="p">(</span><span class="n">imported_image_height</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)),</span>
            <span class="n">resample</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span>

        <span class="c1"># self.resized_imported_overlay_ld_img.putalpha(120)</span>
        <span class="n">imported_overlay_image_tk</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resized_imported_overlay_ld_img</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
            <span class="n">center_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_maxed</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">center_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_maxed</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">center_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_windowed</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">center_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_windowed</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="n">tags</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;overlay_img&quot;</span><span class="p">)</span>
        <span class="n">placed_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">overlay_canvas</span><span class="o">.</span><span class="n">create_image</span><span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                                                            <span class="n">image</span><span class="o">=</span><span class="n">imported_overlay_image_tk</span><span class="p">,</span>
                                                            <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
            <span class="n">img_max_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resized_imported_overlay_ld_img</span><span class="o">.</span><span class="n">size</span>
            <span class="n">img_proxy_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resized_imported_overlay_ld_img</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                                                    <span class="n">scale_item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">round_</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">max_coordinates</span> <span class="o">=</span> <span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">)</span>
            <span class="n">proxy_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">max_coordinates</span><span class="p">,</span> <span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                                                       <span class="n">scale_item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">img_max_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resized_imported_overlay_ld_img</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
                                                  <span class="n">scale_item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">round_</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">img_proxy_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resized_imported_overlay_ld_img</span><span class="o">.</span><span class="n">size</span>
            <span class="n">proxy_coordinates</span> <span class="o">=</span> <span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">)</span>
            <span class="n">max_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">proxy_coordinates</span><span class="p">,</span> <span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
                                                     <span class="n">scale_item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>

        <span class="c1"># Image size relative to overlay_canvas size.</span>
        <span class="n">img_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescale_overlay_elements_to_absolute_overlay_size</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">img_max_size</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
                                                                          <span class="n">round_</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates_to_image_size</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">max_coordinates</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_IMAGES_INDEX</span><span class="p">][</span><span class="n">placed_image</span><span class="p">]</span> <span class="o">=</span> <span class="n">OverlayImageCache</span><span class="p">(</span>
            <span class="n">image_object</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">imported_overlay_ld_img</span><span class="p">,</span>
            <span class="n">image_path</span><span class="o">=</span><span class="n">image_path</span><span class="p">,</span>
            <span class="n">coordinates</span><span class="o">=</span><span class="p">(</span><span class="n">coordinates</span><span class="p">),</span>
            <span class="n">max_coordinates</span><span class="o">=</span><span class="n">max_coordinates</span><span class="p">,</span>
            <span class="n">proxy_coordinates</span><span class="o">=</span><span class="n">proxy_coordinates</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">img_size</span><span class="p">,</span>
            <span class="n">max_size</span><span class="o">=</span><span class="n">img_max_size</span><span class="p">,</span>
            <span class="n">proxy_size</span><span class="o">=</span><span class="n">img_proxy_size</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">imported_overlay_image_cache</span><span class="p">[</span><span class="n">placed_image</span><span class="p">]</span> <span class="o">=</span> <span class="n">imported_overlay_image_tk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_overlay_image</span><span class="p">(</span><span class="n">image_id</span><span class="o">=</span><span class="n">placed_image</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.select_canvas_item">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.select_canvas_item">[docs]</a>
    <span class="k">def</span> <span class="nf">select_canvas_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">item_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches the clicked item on the canvas. If the item is an image or text, draw the surrounding border.</span>

<span class="sd">        Args:</span>
<span class="sd">           event(tkinter.Event): Mouse Click event</span>
<span class="sd">           item_id(int):id of the canvas item.</span>

<span class="sd">        Returns:</span>
<span class="sd">           None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Remove any existing selected items from selection.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">overlay_gm</span><span class="o">.</span><span class="n">remove_overlay_image_selection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_text_item_selection</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">item_id</span><span class="p">:</span>
            <span class="n">item_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">find_closest</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">item_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">gettags</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;overlay_img&quot;</span> <span class="ow">in</span> <span class="n">item_tags</span><span class="p">:</span>  <span class="c1"># Child methods</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">overlay_gm</span><span class="o">.</span><span class="n">select_overlay_image</span><span class="p">(</span><span class="n">image_id</span><span class="o">=</span><span class="n">item_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">overlay_gm</span><span class="o">.</span><span class="n">set_overlay_image_drag_offset</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">elif</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="n">item_tags</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_text_drag_offset</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">select_text_item</span><span class="p">(</span><span class="n">text_id</span><span class="o">=</span><span class="n">item_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.select_overlay_image">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.select_overlay_image">[docs]</a>
    <span class="k">def</span> <span class="nf">select_overlay_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assigns the overlay image item as the selected_overlay_image and draws the selection border around it.</span>

<span class="sd">        Args:</span>
<span class="sd">             image_id (int): id of the text item on the canvas.</span>

<span class="sd">        Returns:</span>
<span class="sd">             None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">img_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="n">image_id</span><span class="p">)</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">img_bounds</span>
        <span class="n">border_coordinates</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_selection_border</span><span class="p">,</span> <span class="n">border_coordinates</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">tag_raise</span><span class="p">(</span><span class="s2">&quot;gui&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_selection_border</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">selection_color</span><span class="p">)</span>
        <span class="c1"># Assigning the selected canvas image item as the selected_overlay_image.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span> <span class="o">=</span> <span class="n">image_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_IMAGES_INDEX</span><span class="p">][</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">]</span>

        <span class="c1"># shows the current opacity of the overlay image.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">set_opacity_slider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">opacity</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">set_rotation_slider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">angle</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">toggle_image_tools_sliders</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">toggle_image_tools_buttons</span><span class="p">(</span><span class="n">only_reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">toggle</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.remove_overlay_image_selection">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.remove_overlay_image_selection">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_overlay_image_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the selection of the selected overlay image, and resets the image control sliders.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_selection_border</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">set_opacity_slider</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">set_rotation_slider</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">toggle_image_tools_sliders</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">toggle_image_tools_buttons</span><span class="p">(</span><span class="n">only_reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">toggle</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># disable image reset button.</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.rescale_overlay_images_to_view">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.rescale_overlay_images_to_view">[docs]</a>
    <span class="k">def</span> <span class="nf">rescale_overlay_images_to_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates through the overlay images and scales them to match the current display mode.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
            <span class="n">window_maxed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">window_maxed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">image_cache</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_IMAGES_INDEX</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># get current size and multiply by scale factor</span>
            <span class="n">current_image_object</span><span class="p">:</span> <span class="n">Image</span> <span class="o">=</span> <span class="n">image_cache</span><span class="o">.</span><span class="n">image_object</span>
            <span class="n">current_image_size</span> <span class="o">=</span> <span class="n">image_cache</span><span class="o">.</span><span class="n">size</span>
            <span class="n">current_image_rotation</span> <span class="o">=</span> <span class="n">image_cache</span><span class="o">.</span><span class="n">angle</span>

            <span class="k">if</span> <span class="n">window_maxed</span><span class="p">:</span>
                <span class="n">current_image_max_size</span> <span class="o">=</span> <span class="n">image_cache</span><span class="o">.</span><span class="n">max_size</span>
                <span class="n">current_image_max_coordinates</span> <span class="o">=</span> <span class="n">image_cache</span><span class="o">.</span><span class="n">max_coordinates</span>
                <span class="n">resized_imported_overlay_ld_img</span> <span class="o">=</span> <span class="n">current_image_object</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">current_image_max_size</span><span class="p">,</span>
                                                                              <span class="n">resample</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">current_image_proxy_size</span> <span class="o">=</span> <span class="n">image_cache</span><span class="o">.</span><span class="n">proxy_size</span>
                <span class="n">current_image_proxy_coordinates</span> <span class="o">=</span> <span class="n">image_cache</span><span class="o">.</span><span class="n">proxy_coordinates</span>
                <span class="n">resized_imported_overlay_ld_img</span> <span class="o">=</span> <span class="n">current_image_object</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">current_image_proxy_size</span><span class="p">,</span>
                                                                              <span class="n">resample</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">current_image_rotation</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">resized_imported_overlay_ld_img</span> <span class="o">=</span> <span class="n">resized_imported_overlay_ld_img</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">current_image_rotation</span><span class="p">,</span>
                                                                                         <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="p">)</span>

            <span class="n">imported_overlay_image_tk</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">resized_imported_overlay_ld_img</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">overlay_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">imported_overlay_image_tk</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">window_maxed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">overlay_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">current_image_max_coordinates</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">overlay_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">current_image_proxy_coordinates</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">imported_overlay_image_cache</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">imported_overlay_image_tk</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.delete_item">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.delete_item">[docs]</a>
    <span class="k">def</span> <span class="nf">delete_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the selected overlay image or text item from the canvas, and deletes the data from the dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            event (tkinter.Event): Keypress event.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">current_image</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">current_image</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_IMAGES_INDEX</span><span class="p">][</span><span class="n">current_image</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">overlay_gm</span><span class="o">.</span><span class="n">imported_overlay_image_cache</span><span class="p">[</span><span class="n">current_image</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_selection_border</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_overlay_image_selection</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">delete_item</span><span class="p">()</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.set_overlay_image_drag_offset">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.set_overlay_image_drag_offset">[docs]</a>
    <span class="k">def</span> <span class="nf">set_overlay_image_drag_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the initial position for overlay image repositioning.</span>

<span class="sd">        Args:</span>
<span class="sd">            event(tkinter.Event): Mouse click event.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">current_item_bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">)</span>
        <span class="c1"># Calculate the center coordinates of the text item</span>
        <span class="n">center_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_item_bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">current_item_bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">center_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_item_bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">current_item_bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Calculate the offset from the center to the initial click, to avoid image snapping to the cursor.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlay_image_offset_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nb">round</span><span class="p">(</span><span class="n">center_x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlay_image_offset_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nb">round</span><span class="p">(</span><span class="n">center_y</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.reposition_overlay_image">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.reposition_overlay_image">[docs]</a>
    <span class="k">def</span> <span class="nf">reposition_overlay_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">constraint</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Repositions the overlay image using the mouse drag cordinates or a set of predefined coordinates.</span>

<span class="sd">        Args:</span>
<span class="sd">            event (tkinter.Event):Mouse Drag event.</span>
<span class="sd">            position (tuple,optional): New Coordinates for the image.</span>
<span class="sd">            constraint(bool): True constraints the live positioning to a single axis.Default False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">position</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_image_repositioning</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hide_overlay_image_selection_border</span><span class="p">()</span>
                <span class="c1"># Offset so that text anchor won&#39;t snap to mouse position.</span>
                <span class="n">current_mousex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="n">current_mousey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

                <span class="n">new_x</span> <span class="o">=</span> <span class="n">current_mousex</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlay_image_offset_x</span>
                <span class="n">new_y</span> <span class="o">=</span> <span class="n">current_mousey</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlay_image_offset_y</span>

                <span class="k">if</span> <span class="n">constraint</span><span class="p">:</span>
                    <span class="n">dx</span> <span class="o">=</span> <span class="n">current_mousex</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">dy</span> <span class="o">=</span> <span class="n">current_mousey</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_axis_constraint</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>

                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dy</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">x_axis_constraint</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">x_axis_constraint</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_axis_constraint</span><span class="p">:</span>
                        <span class="n">new_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlay_image_offset_y</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">,</span> <span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_click_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlay_image_offset_x</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">,</span> <span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span><span class="p">))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">,</span> <span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">,</span> <span class="p">(</span><span class="n">position</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_overlay_image_coordinates</span><span class="p">()</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.update_overlay_image_coordinates">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.update_overlay_image_coordinates">[docs]</a>
    <span class="k">def</span> <span class="nf">update_overlay_image_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the updated overlay image coordinates into multiple display modes and updates them in the dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">)</span>
        <span class="n">x_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">y_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">new_coords</span> <span class="o">=</span> <span class="n">x_center</span><span class="p">,</span> <span class="n">y_center</span>  <span class="c1"># center coordinates</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
            <span class="n">max_coordinates</span> <span class="o">=</span> <span class="n">new_coords</span>
            <span class="n">proxy_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">max_coordinates</span><span class="p">,</span>
                                                       <span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                                                       <span class="n">scale_item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">proxy_coordinates</span> <span class="o">=</span> <span class="n">new_coords</span>
            <span class="n">max_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">proxy_coordinates</span><span class="p">,</span>
                                                     <span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
                                                     <span class="n">scale_item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>

        <span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates_to_image_size</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">max_coordinates</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
        <span class="c1"># update the coordinates of the image in all screen views.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">max_coordinates</span> <span class="o">=</span> <span class="n">max_coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">proxy_coordinates</span> <span class="o">=</span> <span class="n">proxy_coordinates</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.scale_overlay_image">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.scale_overlay_image">[docs]</a>
    <span class="k">def</span> <span class="nf">scale_overlay_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">increment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scales the selected overlay image by a multiplier value.</span>

<span class="sd">        Args:</span>
<span class="sd">            factor (float):Value that multiplies the scale of the current selected overlay image.</span>
<span class="sd">            size (tuple,optional): Predefined size for the selected overlay image.</span>
<span class="sd">            increment (str,optional): &quot;+&quot; Increments image scale by +1 and &quot;-&quot; decrements the scale by 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">scale_fac</span> <span class="o">=</span> <span class="n">factor</span>
        <span class="c1"># Accessing the OverlayImageCache containing the current image.</span>
        <span class="n">selected_image_cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span>
        <span class="n">current_ld_image</span> <span class="o">=</span> <span class="n">selected_image_cache</span><span class="o">.</span><span class="n">image_object</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_image_scaling</span><span class="p">:</span>
            <span class="c1"># first time during scaling</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>  <span class="c1"># get the current dimensions based on view.</span>
                <span class="n">current_image_size</span> <span class="o">=</span> <span class="n">selected_image_cache</span><span class="o">.</span><span class="n">max_size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">current_image_size</span> <span class="o">=</span> <span class="n">selected_image_cache</span><span class="o">.</span><span class="n">proxy_size</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">stored_image_size</span> <span class="o">=</span> <span class="n">current_image_size</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Same initial value will be used unless the click is released.</span>
            <span class="n">current_image_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stored_image_size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hide_overlay_image_selection_border</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">increment</span><span class="p">:</span>
            <span class="n">rescaled_size</span> <span class="o">=</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">dimension</span> <span class="o">*</span> <span class="n">scale_fac</span><span class="p">)</span> <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="n">current_image_size</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_image_scaling</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">increment</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">increment</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span>
                <span class="n">rescaled_size</span> <span class="o">=</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">dimension</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="n">current_image_size</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">increment</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
                <span class="n">rescaled_size</span> <span class="o">=</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">dimension</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="n">current_image_size</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reveal_overlay_image_selection_border</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_image_scaling</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">rescaled_size</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">size</span><span class="p">:</span>  <span class="c1"># a defined scale is provided.</span>
            <span class="n">resized_selected_overlay_img</span> <span class="o">=</span> <span class="n">current_ld_image</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">resized_selected_overlay_img</span> <span class="o">=</span> <span class="n">current_ld_image</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">rescaled_size</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span>

        <span class="n">selected_overlay_image_tk</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">resized_selected_overlay_img</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">overlay_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">selected_overlay_image_tk</span><span class="p">)</span>

        <span class="c1"># Saving the reference to prevent garbage collection.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imported_overlay_image_cache</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_overlay_image_tk</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
            <span class="n">img_max_size</span> <span class="o">=</span> <span class="n">resized_selected_overlay_img</span><span class="o">.</span><span class="n">size</span>
            <span class="n">img_proxy_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="n">img_max_size</span><span class="p">,</span> <span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">scale_item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">round_</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">img_proxy_size</span> <span class="o">=</span> <span class="n">resized_selected_overlay_img</span><span class="o">.</span><span class="n">size</span>
            <span class="n">img_max_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_coordinates</span><span class="p">(</span><span class="n">img_proxy_size</span><span class="p">,</span> <span class="n">scale_mode</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">scale_item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">round_</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">img_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescale_overlay_elements_to_absolute_overlay_size</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">img_max_size</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
                                                                          <span class="n">round_</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># updating the values in the OverlayImageCache</span>
        <span class="n">selected_image_cache</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">img_size</span>
        <span class="n">selected_image_cache</span><span class="o">.</span><span class="n">max_size</span> <span class="o">=</span> <span class="n">img_max_size</span>
        <span class="n">selected_image_cache</span><span class="o">.</span><span class="n">proxy_size</span> <span class="o">=</span> <span class="n">img_proxy_size</span>
        <span class="c1"># Redrawing opacity here, no other way to get a live preview of semitransparent images.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redraw_selected_image</span><span class="p">(</span><span class="n">redraw_rotation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">redraw_opacity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.rotate_overlay_image">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.rotate_overlay_image">[docs]</a>
    <span class="k">def</span> <span class="nf">rotate_overlay_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotates the selected overlay image by the given value.</span>

<span class="sd">        Args:</span>
<span class="sd">            value (int):Integer of range 0 to 360.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">:</span>
            <span class="n">selected_image_cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span>
            <span class="n">current_ld_image</span> <span class="o">=</span> <span class="n">selected_image_cache</span><span class="o">.</span><span class="n">image_object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">value</span>
            <span class="c1"># Redrawing opacity here, no other way to get a live preview of semitransparent images.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redraw_selected_image</span><span class="p">(</span><span class="n">redraw_rotation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">redraw_opacity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reveal_overlay_image_selection_border</span><span class="p">()</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.change_overlay_image_opacity">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.change_overlay_image_opacity">[docs]</a>
    <span class="k">def</span> <span class="nf">change_overlay_image_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Controls the opacity of the selected overlay image.</span>

<span class="sd">        Args:</span>
<span class="sd">            opacity(float): Float range from 0 to 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">             None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">:</span>
            <span class="n">opacity_value</span> <span class="o">=</span> <span class="n">opacity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="n">opacity_value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redraw_selected_image</span><span class="p">(</span><span class="n">redraw_opacity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">redraw_rotation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.redraw_selected_image">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.redraw_selected_image">[docs]</a>
    <span class="k">def</span> <span class="nf">redraw_selected_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redraw_opacity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">redraw_rotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Redraws the selected overlay image by loading it from disk and applying the re applying the transformations and opacity.</span>

<span class="sd">        Args:</span>
<span class="sd">            redraw_opacity (bool): True updates the image opacity using the stored value. False skips the operation. Default False</span>
<span class="sd">            redraw_rotation (bool): True updates the image rotation using the stored value. False skips the operation. Default False</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">:</span>
            <span class="n">image_object_to_redraw</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">image_path</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">)</span>
            <span class="c1"># image_object_to_redraw=self.selected_overlay_image_cache.image_object</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="n">redraw_opacity</span><span class="p">:</span>
                <span class="c1"># image_object_to_redraw.putalpha(255) #reset to 100</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">image_object_to_redraw</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">opacity</span><span class="p">)</span>
                <span class="n">image_object_to_redraw</span><span class="o">.</span><span class="n">putalpha</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
            <span class="c1"># reduced transparent object at full size. this transparent img object will be used for scale and transform.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">image_object</span> <span class="o">=</span> <span class="n">image_object_to_redraw</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_mode</span><span class="p">:</span>
                <span class="n">image_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">max_size</span>
                <span class="n">image_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">max_coordinates</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">image_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">proxy_size</span>
                <span class="n">image_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">proxy_coordinates</span>

            <span class="c1"># Scaling the image to match its old scale.</span>

            <span class="n">image_object_to_redraw</span> <span class="o">=</span> <span class="n">image_object_to_redraw</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image_scale</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">redraw_rotation</span><span class="p">:</span>
                <span class="n">rotation_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image_cache</span><span class="o">.</span><span class="n">angle</span>
                <span class="n">image_object_to_redraw</span> <span class="o">=</span> <span class="n">image_object_to_redraw</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">rotation_value</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="p">)</span>

            <span class="n">selected_overlay_image_tk</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">image_object_to_redraw</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">overlay_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">selected_overlay_image_tk</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imported_overlay_image_cache</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_overlay_image_tk</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.reset_selected_image">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.reset_selected_image">[docs]</a>
    <span class="k">def</span> <span class="nf">reset_selected_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets the loaded overlay image to the size and position during import by reloading it from disk.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selected_ld_image_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_IMAGES_INDEX</span><span class="p">][</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">]</span><span class="o">.</span><span class="n">image_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_item</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_image_to_overlay_canvas</span><span class="p">(</span><span class="n">image_path</span><span class="o">=</span><span class="n">selected_ld_image_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.wipe_current_annotations">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.wipe_current_annotations">[docs]</a>
    <span class="k">def</span> <span class="nf">wipe_current_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wipes all overlay images added to the Overlay canvas.</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image_items_to_delete</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_IMAGES_INDEX</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">image_items_to_delete</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">overlay_canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">graphics_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_IMAGES_INDEX</span><span class="p">][</span><span class="n">image</span><span class="p">]</span>  <span class="c1"># removes the p</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">remove_overlay_image_selection</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">wipe_current_annotations</span><span class="p">()</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.hide_overlay_image_selection_border">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.hide_overlay_image_selection_border">[docs]</a>
    <span class="k">def</span> <span class="nf">hide_overlay_image_selection_border</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hides the selection border of the overlay image.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_selection_border</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.reveal_overlay_image_selection_border">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.reveal_overlay_image_selection_border">[docs]</a>
    <span class="k">def</span> <span class="nf">reveal_overlay_image_selection_border</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays the selection border of the selected overlay image.</span>


<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span><span class="p">:</span>
            <span class="n">image_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_overlay_image</span>
            <span class="n">img_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="n">image_id</span><span class="p">)</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">img_bounds</span>
            <span class="n">border_coordinates</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_selection_border</span><span class="p">,</span> <span class="n">border_coordinates</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">tag_raise</span><span class="p">(</span><span class="s2">&quot;gui&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_selection_border</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">is_image_scaling</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_image_repositioning</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_axis_constraint</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.hide_parent_overlay_annotations">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.hide_parent_overlay_annotations">[docs]</a>
    <span class="k">def</span> <span class="nf">hide_parent_overlay_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># Hide the graphic objects on screen</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hides the annotations displayed on maximized display mode.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="s2">&quot;m-1&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.reveal_parent_overlay_annotations">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.reveal_parent_overlay_annotations">[docs]</a>
    <span class="k">def</span> <span class="nf">reveal_parent_overlay_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reveals the annotations displayed on maximized display mode.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="s2">&quot;m-1&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.hide_proxy_overlay_annotations">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.hide_proxy_overlay_annotations">[docs]</a>
    <span class="k">def</span> <span class="nf">hide_proxy_overlay_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hides the annotations displayed on windowed display mode.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="s2">&quot;w-1&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.reveal_proxy_overlay_annotations">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.reveal_proxy_overlay_annotations">[docs]</a>
    <span class="k">def</span> <span class="nf">reveal_proxy_overlay_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reveals the annotations displayed on windowed display mode.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="s2">&quot;w-1&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.rescale_overlay_elements_to_absolute_overlay_size">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.rescale_overlay_elements_to_absolute_overlay_size">[docs]</a>
    <span class="k">def</span> <span class="nf">rescale_overlay_elements_to_absolute_overlay_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">round_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the attributes of the overlay elements to match the size of the overlay ghost image (1920x1080).</span>

<span class="sd">        Args:</span>
<span class="sd">            element : Coordinates, width , fontsize to rescale to the absolute size of the overlay.</span>
<span class="sd">            item (str): Type of item.</span>
<span class="sd">            round_ (bool): True rounds the float to an integer. Default False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Rescaled element data that matches the size of the Overlay ghost image size.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get rescaled values of elements in the absolute overlay canvas size.</span>
        <span class="c1"># old_width, old_height = self.app.image_frame_width_maxed,self.app.image_frame_height_maxed</span>
        <span class="c1"># # Converting the image to a 16:9 ratio space since the global canvas coords are stored in 16:9 image.</span>
        <span class="c1"># canvas_width = 16 * old_height // 9</span>
        <span class="c1"># canvas_height = old_height</span>
        <span class="c1"># if canvas_width &lt; old_width:</span>
        <span class="c1">#     canvas_width = old_width</span>
        <span class="c1">#     canvas_height = 9 * old_width // 16</span>

        <span class="n">old_width</span><span class="p">,</span> <span class="n">old_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_maxed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_maxed</span>
        <span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_WIDTH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_HEIGHT</span>

        <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">new_width</span> <span class="o">/</span> <span class="n">old_width</span>

        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">coordinate</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">element</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;font&quot;</span><span class="p">:</span>
            <span class="n">new_font_size</span> <span class="o">=</span> <span class="n">element</span> <span class="o">*</span> <span class="n">scale_factor</span>
            <span class="k">if</span> <span class="n">new_font_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># incase bug causes the -ve to +ve</span>
                <span class="n">new_font_size</span> <span class="o">=</span> <span class="o">-</span><span class="n">new_font_size</span>
            <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">new_font_size</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span>
            <span class="n">float_stroke_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">element</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">float_stroke_width</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">adjusted_stroke_width</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">adjusted_stroke_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">float_stroke_width</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">adjusted_stroke_width</span>

        <span class="k">elif</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;image&quot;</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">coordinate</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">element</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">round_</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># item=Coords</span>
            <span class="n">true_coordinates</span> <span class="o">=</span> <span class="p">[((</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">element</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">true_coordinates</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.get_viewport_size_from_absolute_overlay_size">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.get_viewport_size_from_absolute_overlay_size">[docs]</a>
    <span class="k">def</span> <span class="nf">get_viewport_size_from_absolute_overlay_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinate_list</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">round_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Route method that calls the image_coordinates_to_max_size.</span>

<span class="sd">        Args:</span>
<span class="sd">            coordinate_list (tuple|list): Coordinates to be scaled from the absolute size to match the maximized display mode.</span>
<span class="sd">            item (str): Canvas item.</span>
<span class="sd">            round_ (bool): True rounds the float to an integer. Default False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Rescaled coordinates that matches the maximized display mode of the overlay canvas.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_coordinates_to_max_size</span><span class="p">(</span><span class="n">coordinate_list</span><span class="o">=</span><span class="n">coordinate_list</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">round_</span><span class="o">=</span><span class="n">round_</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.coordinates_to_image_size">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.coordinates_to_image_size">[docs]</a>
    <span class="k">def</span> <span class="nf">coordinates_to_image_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinate_list</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">round_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Route method that calls the rescale_overlay_elements_to_absolute_overlay_size.</span>

<span class="sd">        Args:</span>
<span class="sd">            coordinate_list: Coordinates to be scaled to match the size of the Ghost Overlay image.</span>
<span class="sd">            item (str): Item in the canvas.</span>
<span class="sd">            round_ (bool): True rounds the float to an integer. Default False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Rescaled coordinates that matches the Ghost Image size of the Overlay Canvas (1920x1080).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescale_overlay_elements_to_absolute_overlay_size</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">coordinate_list</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">round_</span><span class="o">=</span><span class="n">round_</span><span class="p">)</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.width_to_image_size">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.width_to_image_size">[docs]</a>
    <span class="k">def</span> <span class="nf">width_to_image_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stroke_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scales the width to match the size of the Overlay Ghost Image.</span>

<span class="sd">        Args:</span>
<span class="sd">            stroke_width: Width to scale.</span>
<span class="sd">            item (str): canvas item</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float|int): Scaled width matching the overlay canvas size.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stroke_width</span><span class="p">:</span>  <span class="c1"># getting -50 here</span>
            <span class="n">current_stroke_width</span> <span class="o">=</span> <span class="n">Tools</span><span class="o">.</span><span class="n">stroke_width</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_stroke_width</span> <span class="o">=</span> <span class="n">stroke_width</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescale_overlay_elements_to_absolute_overlay_size</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">stroke_width</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span></div>

        <span class="c1"># return self.coordinates_to_image_size(coordinate_list=stroke_width, item=item)</span>

<div class="viewcode-block" id="OverlayGraphicsManager.image_coordinates_to_max_size">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.image_coordinates_to_max_size">[docs]</a>
    <span class="k">def</span> <span class="nf">image_coordinates_to_max_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinate_list</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">round_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the coordinates from Ghost Overlay Image to match the maximized display mode. Used while loading a project file.</span>

<span class="sd">        Args:</span>
<span class="sd">            coordinate_list :  Coordinates to rescale.</span>
<span class="sd">            item (str):Canvas item.</span>
<span class="sd">            round_(bool): True rounds the float to an integer. Default False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Coordinates that match the maximzed display mode.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># to use with save and load</span>
        <span class="n">old_width</span><span class="p">,</span> <span class="n">old_height</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_WIDTH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_HEIGHT</span><span class="p">)</span>
        <span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_maxed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_maxed</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">new_width</span> <span class="o">/</span> <span class="n">old_width</span>

        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;text&quot;</span> <span class="ow">or</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;image&quot;</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">coordinate</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">coordinate_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">round_</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">maximized_coordinates</span> <span class="o">=</span> <span class="p">[((</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">coordinate_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">maximized_coordinates</span></div>


<div class="viewcode-block" id="OverlayGraphicsManager.convert_width_to_max_size">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayGraphicsManager.convert_width_to_max_size">[docs]</a>
    <span class="k">def</span> <span class="nf">convert_width_to_max_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stroke_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Converts the width from Ghost Overlay Image to match the maximized display mode. Used while loading a project file.</span>

<span class="sd">        Args:</span>
<span class="sd">            stroke_width:</span>
<span class="sd">            item (str):Canvas item.</span>

<span class="sd">         Returns:</span>
<span class="sd">                  Width or Fontsize that match the maximzed display mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Since the width is saved to match the actual image in the main cache, resizing here to match the viewport.</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">stroke_width</span><span class="p">:</span>
            <span class="n">width_from_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width_to_image_size</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">width_from_image</span> <span class="o">=</span> <span class="n">stroke_width</span>

        <span class="n">old_width</span><span class="p">,</span> <span class="n">old_height</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_WIDTH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OVERLAY_HEIGHT</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>  <span class="c1"># Using image_frame here since overlay and image frame is 16:9</span>
            <span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_maxed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_maxed</span>
        <span class="k">except</span><span class="p">:</span>  <span class="c1"># Failsafe</span>
            <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ld_img</span><span class="o">.</span><span class="n">height</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_maxed</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_maxed</span> <span class="o">*</span> <span class="n">aspect_ratio</span><span class="p">))</span>
            <span class="n">height</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_height_maxed</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image_frame_width_maxed</span> <span class="o">/</span> <span class="n">aspect_ratio</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_canvas_size</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>
            <span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">maximized_canvas_size</span>

        <span class="n">width_scale_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_width</span> <span class="o">/</span> <span class="n">old_width</span><span class="p">)</span>
        <span class="n">float_stroke_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">width_from_image</span> <span class="o">*</span> <span class="n">width_scale_factor</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;font&quot;</span><span class="p">:</span>  <span class="c1"># Font size are -ve because tkinter user -ve size as pixel size.</span>
            <span class="k">if</span> <span class="n">float_stroke_width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">float_stroke_width</span> <span class="o">=</span> <span class="o">-</span><span class="n">float_stroke_width</span>
            <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">float_stroke_width</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">float_stroke_width</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">adjusted_stroke_width</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adjusted_stroke_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">float_stroke_width</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">adjusted_stroke_width</span></div>
</div>



<div class="viewcode-block" id="GraphicsCache">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.GraphicsCache">[docs]</a>
<span class="nd">@dataclass</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">GraphicsCache</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object that stores the coordinates and attributes of the plotted 2d graphic elements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># tool:str</span>
    <span class="n">coordinates</span><span class="p">:</span> <span class="nb">list</span>  <span class="c1"># coordinates</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># width</span>
    <span class="n">tags</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">tuple</span>  <span class="c1"># tags</span>
    <span class="n">tool</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># tool id</span>
    <span class="n">fill_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># fill</span>
    <span class="n">shape_fill</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">interior_fill_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">outline_fill_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">stipple</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">joinstyle</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;round&quot;</span>  <span class="c1"># joinstyle</span>
    <span class="n">capstyle</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;round&quot;</span>  <span class="c1"># capstyle</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">font_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">font_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">font_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="OverlayImageCache">
<a class="viewcode-back" href="../graphics_manager.html#graphics_manager.OverlayImageCache">[docs]</a>
<span class="nd">@dataclass</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">OverlayImageCache</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object that stores the filepath and transformation values for the imported overlay image elements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image_object</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span>  <span class="c1"># obj from Image.open(image_path)</span>
    <span class="n">image_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">coordinates</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span>  <span class="c1"># coordinates</span>
    <span class="n">max_coordinates</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span>
    <span class="n">proxy_coordinates</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span>
    <span class="n">max_size</span><span class="p">:</span> <span class="nb">tuple</span>
    <span class="n">proxy_size</span><span class="p">:</span> <span class="nb">tuple</span>
    <span class="n">opacity</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">angle</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">tags</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">tuple</span>  <span class="c1"># tags</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Agnivesh S P.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>